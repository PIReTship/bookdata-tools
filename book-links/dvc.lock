schema: '2.0'
stages:
  collect-isbns:
    cmd: python ../run.py --rust collect-isbns -o all-isbns.parquet all-isbns.toml
    deps:
    - path: ../az2014/ratings.parquet
      md5: 16442bc70b86c53dc8e5941ac85e7a18
      size: 136992321
    - path: ../az2018/ratings.parquet
      md5: ea664babdc393f2ee15df23616903990
      size: 315697300
    - path: ../bx/cleaned-ratings.csv
      md5: e2c423d665fb5271def51d358c8c285c
      size: 22627335
    - path: ../goodreads/gr-book-ids.parquet
      md5: b29c1441c2377d98a803c0cc38b0bc33
      size: 37758445
    - path: ../loc-mds/book-isbns.parquet
      md5: 0775712f467248239f0d8f6e6daa3302
      size: 56227773
    - path: ../openlibrary/edition-isbns.parquet
      md5: 01512ce2cc14b72d23b039d132f194f5
      size: 211695542
    - path: ../src/cli/collect_isbns.rs
      md5: f571b64428731233e14f122f644c3ee7
      size: 2625
    - path: all-isbns.toml
      md5: 58da443b1ccfdd3def283c05408179d8
      size: 486
    outs:
    - path: all-isbns.parquet
      md5: f1de86d41234d3b0ea975be3a188a0cc
      size: 275147630
  cluster:
    cmd: python run.py --rust cluster-books --save-graph book-links/book-graph.mp.zst
    deps:
    - path: book-links/all-isbns.parquet
      md5: f1de86d41234d3b0ea975be3a188a0cc
      size: 275147630
    - path: goodreads/book-isbn-ids.parquet
      md5: 26b5fc73cbc447466f64d1de1ccb585b
      size: 15485013
    - path: goodreads/gr-book-ids.parquet
      md5: b29c1441c2377d98a803c0cc38b0bc33
      size: 37758445
    - path: loc-mds/book-ids.parquet
      md5: 38346ca168b32be26216dba43e5a6ef4
      size: 66927842
    - path: loc-mds/book-isbn-ids.parquet
      md5: d318bbfa7f023370f780aa74c0bd60b5
      size: 33782689
    - path: openlibrary/all-works.parquet
      md5: 1b9a3d75dd8a0e4c25176daf864d1ee2
      size: 181910106
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 41b3c9f8c0daef62b26c4cc6049f69df
      size: 145369776
    - path: openlibrary/edition-works.parquet
      md5: 53632b1fc28f4bc8f0775f5518ec865b
      size: 203821436
    - path: openlibrary/editions.parquet
      md5: bc080214dcb896f99624cb14d13c9706
      size: 887407054
    - path: src/cli/cluster_books.rs
      md5: 70a2df121cd20e24bee442a2c207b52f
      size: 4855
    - path: src/graph/
      md5: 5ce7189a6287c4543e5f8447802fdc80.dir
      size: 9432
      nfiles: 4
    outs:
    - path: book-links/book-graph.mp.zst
      md5: 5e66366edc8cc94dd8fed8d5a2079294
      size: 1236966039
    - path: book-links/cluster-graph-edges.parquet
      md5: 737be3acfc4bf73c2e3929fca2262c6a
      size: 417463484
    - path: book-links/cluster-graph-nodes.parquet
      md5: c03cf0b0fd6450d21bbb728a52abf01b
      size: 832827586
    - path: book-links/cluster-metrics.json
      md5: 905e5056cef17bb04890e71c546bd345
      size: 37
    - path: book-links/cluster-stats.parquet
      md5: 9c42fb9dafa6afe6cf3a435938b4a5c6
      size: 139978223
    - path: book-links/isbn-clusters.parquet
      md5: 0d131195d46e52b7744f19fc96ccdebf
      size: 335303074
  cluster-ol-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-ol-first-authors.parquet
      --first-author -s openlib
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 0d131195d46e52b7744f19fc96ccdebf
      size: 335303074
    - path: openlibrary/author-names.parquet
      md5: 1af0e26605c0f6b58b9c881d53633622
      size: 149833187
    - path: openlibrary/edition-authors.parquet
      md5: 887d3b1709b880338a9e93ecbeb213f6
      size: 193094588
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 41b3c9f8c0daef62b26c4cc6049f69df
      size: 145369776
    - path: src/cli/cluster
      md5: c50b60cd98fb3751de58f705b83b1c29.dir
      size: 17331
      nfiles: 7
    outs:
    - path: book-links/cluster-ol-first-authors.parquet
      md5: 81634cbe209b6cab58a789bcd77a3e82
      size: 247928437
  cluster-loc-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-loc-first-authors.parquet
      --first-author -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 0d131195d46e52b7744f19fc96ccdebf
      size: 335303074
    - path: loc-mds/book-authors.parquet
      md5: 3585eceab422d960e403a2a146bb0b5f
      size: 84128212
    - path: loc-mds/book-isbn-ids.parquet
      md5: d318bbfa7f023370f780aa74c0bd60b5
      size: 33782689
    - path: src/cli/cluster
      md5: c50b60cd98fb3751de58f705b83b1c29.dir
      size: 17331
      nfiles: 7
    outs:
    - path: book-links/cluster-loc-first-authors.parquet
      md5: 5e681b546a8898e3c3520d7fae350d9d
      size: 51658061
  cluster-irst-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5ee9bb4b67de722e24363e140ea2791f
      size: 161946382
    - path: loc-mds/book-authors.parquet
      md5: 2d3212dbf2405c48fb8bf2587a8587c3
      size: 127567010
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: 76f614625858e7ad84e273e875861490
      size: 5253
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a7f439659cccd809efe4ac2ea276b058
      size: 157637977
  cluster-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 0d131195d46e52b7744f19fc96ccdebf
      size: 335303074
    - path: loc-mds/book-authors.parquet
      md5: 3585eceab422d960e403a2a146bb0b5f
      size: 84128212
    - path: loc-mds/book-isbn-ids.parquet
      md5: d318bbfa7f023370f780aa74c0bd60b5
      size: 33782689
    - path: openlibrary/author-names.parquet
      md5: 1af0e26605c0f6b58b9c881d53633622
      size: 149833187
    - path: openlibrary/edition-authors.parquet
      md5: 887d3b1709b880338a9e93ecbeb213f6
      size: 193094588
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 41b3c9f8c0daef62b26c4cc6049f69df
      size: 145369776
    - path: src/cli/cluster
      md5: c50b60cd98fb3751de58f705b83b1c29.dir
      size: 17331
      nfiles: 7
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: 4e1577ab105d1627a80764952582985d
      size: 304489005
  cluster-genders:
    cmd: python run.py --rust cluster extract-author-gender -o book-links/cluster-genders.parquet
      -A book-links/cluster-first-authors.parquet
    deps:
    - path: book-links/cluster-first-authors.parquet
      md5: 4e1577ab105d1627a80764952582985d
      size: 304489005
    - path: book-links/cluster-stats.parquet
      md5: 9c42fb9dafa6afe6cf3a435938b4a5c6
      size: 139978223
    - path: src/cli/cluster
      md5: c50b60cd98fb3751de58f705b83b1c29.dir
      size: 17331
      nfiles: 7
    - path: viaf/author-genders.parquet
      md5: f22e08510e3b70e749400b5019760350
      size: 115076921
    - path: viaf/author-name-index.parquet
      md5: 254a39021dedbd8c7a994fd2c4fbdc67
      size: 516451943
    outs:
    - path: book-links/cluster-genders.parquet
      md5: 506185f98acd90041e1a7d5ed93c58fa
      size: 127851092
  gender-stats:
    cmd: python run.py --rust integration-stats
    deps:
    - path: az2014/az-cluster-ratings.parquet
      md5: ccc4bbf486f8ad1c7c458db220f573aa
      size: 291819116
    - path: az2018/az-cluster-ratings.parquet
      md5: fa8655604726e2abf3423b5b85346bf1
      size: 666545309
    - path: book-links/cluster-genders.parquet
      md5: 506185f98acd90041e1a7d5ed93c58fa
      size: 127851092
    - path: book-links/isbn-clusters.parquet
      md5: 0d131195d46e52b7744f19fc96ccdebf
      size: 335303074
    - path: bx/bx-cluster-actions.parquet
      md5: 55153de0595a9dc2c03057c9bd93a65d
      size: 7072933
    - path: bx/bx-cluster-ratings.parquet
      md5: b56fe9deb6862e0dac1abab8b207bee1
      size: 2989525
    - path: config.toml
      md5: 503d4b6f908c108d776794835d99d0a5
      size: 87
    - path: goodreads/simple/gr-cluster-actions.parquet
      md5: d90f627cb7240afecd40a4c93cd2ad7d
      size: 1471886547
    - path: goodreads/simple/gr-cluster-ratings.parquet
      md5: 8d9e40eed0256e4076bd3cbb06a6ed8f
      size: 690107994
    - path: loc-mds/book-isbn-ids.parquet
      md5: d318bbfa7f023370f780aa74c0bd60b5
      size: 33782689
    - path: src/cli/stats.rs
      md5: 11e3459335330d27a1905db4b9a3932b
      size: 3072
    outs:
    - path: book-links/gender-stats.csv
      md5: b153c36655dc44b106afab90d88bd539
      size: 1337
  cluster-hashes:
    cmd: python ../run.py --rust cluster hash -o cluster-hashes.parquet isbn-clusters.parquet
    deps:
    - path: ../src/cli/cluster/hash.rs
      md5: ab9ea153369e382f1a37b34898ba2f28
      size: 2300
    - path: isbn-clusters.parquet
      md5: 0d131195d46e52b7744f19fc96ccdebf
      size: 335303074
    outs:
    - path: cluster-hashes.parquet
      md5: 66d9eb5a96b890529cd999e98b7ba233
      size: 394978053
  debug-graph:
    cmd: python ./run.py --rust extract-graph --cluster 100004141 -o book-links/debug-graph.gml
    deps:
    - path: book-links/book-graph.mp.zst
      md5: cbb067efc568960af703f83f5b73e9ac
      size: 1283174149
    - path: src/bin/extract-graph.rs
      md5: c22a75eb91d779306a11d8bd2065b3e6
      size: 1142
    outs:
    - path: book-links/debug-graph.gml
      md5: b2fb3c4a07ace6f85a1b880b54ab5da8
      size: 2144356
  schema@cluster-stats:
    cmd: python ../run.py --rust pq-info -o cluster-stats.json cluster-stats.parquet
    deps:
    - path: cluster-stats.parquet
      md5: 9c42fb9dafa6afe6cf3a435938b4a5c6
      size: 139978223
    outs:
    - path: cluster-stats.json
      md5: 9aa5cb3631f2845c02f77d07f0bc60c0
      size: 816
  schema@cluster-first-authors:
    cmd: python ../run.py --rust pq-info -o cluster-first-authors.json cluster-first-authors.parquet
    deps:
    - path: cluster-first-authors.parquet
      md5: 4e1577ab105d1627a80764952582985d
      size: 304489005
    outs:
    - path: cluster-first-authors.json
      md5: ae34b627c85398583f2e48b0a01c912a
      size: 254
  schema@cluster-genders:
    cmd: python ../run.py --rust pq-info -o cluster-genders.json cluster-genders.parquet
    deps:
    - path: cluster-genders.parquet
      md5: 506185f98acd90041e1a7d5ed93c58fa
      size: 127851092
    outs:
    - path: cluster-genders.json
      md5: 5e6b4b52cf7c620da1b686819bc6c043
      size: 249
  schema@all-isbns:
    cmd: python ../run.py --rust pq-info -o all-isbns.json all-isbns.parquet
    deps:
    - path: all-isbns.parquet
      md5: f1de86d41234d3b0ea975be3a188a0cc
      size: 275147630
    outs:
    - path: all-isbns.json
      md5: f0376f4a696277506fc46324c8ebff4d
      size: 762
  schema@cluster-hashes:
    cmd: python ../run.py --rust pq-info -o cluster-hashes.json cluster-hashes.parquet
    deps:
    - path: cluster-hashes.parquet
      md5: 66d9eb5a96b890529cd999e98b7ba233
      size: 394978053
    outs:
    - path: cluster-hashes.json
      md5: 1cbc7d16d158546956154a7243ca7416
      size: 344
  schema@isbn-clusters:
    cmd: python ../run.py --rust pq-info -o isbn-clusters.json isbn-clusters.parquet
    deps:
    - path: isbn-clusters.parquet
      md5: 0d131195d46e52b7744f19fc96ccdebf
      size: 335303074
    outs:
    - path: isbn-clusters.json
      md5: 45f42ebfc9a93180706363d399262f19
      size: 336
