schema: '2.0'
stages:
  collect-isbns:
    cmd: python ../run.py --rust collect-isbns -o all-isbns.parquet all-isbns.toml
    deps:
    - path: ../az2014/ratings.parquet
      md5: 16442bc70b86c53dc8e5941ac85e7a18
      size: 136992321
    - path: ../bx/cleaned-ratings.csv
      md5: da3196d4af84ae39b3713e73c59677c7
      size: 22627884
    - path: ../goodreads/gr-book-ids.parquet
      md5: b29c1441c2377d98a803c0cc38b0bc33
      size: 37758445
    - path: ../loc-mds/book-isbns.parquet
      md5: 9c3a216dbd6ae920ade9ed53eace8df6
      size: 56233310
    - path: ../openlibrary/edition-isbns.parquet
      md5: 5e0dae8e61920a6e60251bc3e0a0f03b
      size: 211653101
    - path: ../src/cli/collect_isbns.rs
      md5: fa71e24fecec60200afb0e9c2066629e
      size: 2545
    - path: all-isbns.toml
      md5: 8d1990ca34a435e464021afb3b5fc9ed
      size: 399
    outs:
    - path: all-isbns.parquet
      md5: 853ac4693adcb143223a383ef65e69e3
      size: 272956344
  cluster:
    cmd: python run.py --rust cluster-books --save-graph book-links/book-graph.mp.zst
    deps:
    - path: book-links/all-isbns.parquet
      md5: 853ac4693adcb143223a383ef65e69e3
      size: 272956344
    - path: goodreads/book-isbn-ids.parquet
      md5: b9fb172668966850787fc8f28942dc73
      size: 23955222
    - path: goodreads/gr-book-ids.parquet
      md5: b29c1441c2377d98a803c0cc38b0bc33
      size: 37758445
    - path: loc-mds/book-ids.parquet
      md5: 38346ca168b32be26216dba43e5a6ef4
      size: 66927842
    - path: loc-mds/book-isbn-ids.parquet
      md5: 78f2fe5cf9b4dc4770576829e365bb3d
      size: 41912948
    - path: openlibrary/all-works.parquet
      md5: 1b9a3d75dd8a0e4c25176daf864d1ee2
      size: 181910106
    - path: openlibrary/edition-isbn-ids.parquet
      md5: e80b638bff4ba31b9407c1522b4de384
      size: 220316416
    - path: openlibrary/edition-works.parquet
      md5: 53632b1fc28f4bc8f0775f5518ec865b
      size: 203821436
    - path: openlibrary/editions.parquet
      md5: bc080214dcb896f99624cb14d13c9706
      size: 887407054
    - path: src/cli/cluster_books.rs
      md5: 9edfd6314d703bda7231ffd9b6cd7741
      size: 4888
    - path: src/graph/
      md5: 98e4edb0d3e823bcaad1c2795e3e6613.dir
      size: 9509
      nfiles: 4
    outs:
    - path: book-links/book-graph.mp.zst
      md5: 4d6748acb32c88229b02781a8b9f592f
      size: 1382314321
    - path: book-links/cluster-graph-edges.parquet
      md5: 2130ba44a615de659931393f9a7e6b3d
      size: 505687983
    - path: book-links/cluster-graph-nodes.parquet
      md5: 90570ae8ad8b92cd7408b2e93438280d
      size: 838775657
    - path: book-links/cluster-metrics.json
      md5: 012acd368e978bfc5fd639022d48cc1d
      size: 37
    - path: book-links/cluster-stats.parquet
      md5: 10d1f8c73928b9f64671f4b927a99d54
      size: 143450830
    - path: book-links/isbn-clusters.parquet
      md5: 6d6bad45f562085798e8d6731cdd56b1
      size: 330399885
  cluster-ol-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-ol-first-authors.parquet
      --first-author -s openlib
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 6d6bad45f562085798e8d6731cdd56b1
      size: 330399885
    - path: openlibrary/author-names.parquet
      md5: 1af0e26605c0f6b58b9c881d53633622
      size: 149833187
    - path: openlibrary/edition-authors.parquet
      md5: 887d3b1709b880338a9e93ecbeb213f6
      size: 193094588
    - path: openlibrary/edition-isbn-ids.parquet
      md5: e80b638bff4ba31b9407c1522b4de384
      size: 220316416
    - path: src/cli/cluster
      md5: a6a5f991654c8faa137637ec71f188ce.dir
      size: 15044
      nfiles: 6
    outs:
    - path: book-links/cluster-ol-first-authors.parquet
      md5: 98a2d040e18398decb07e3cd18020f34
      size: 247928825
  cluster-loc-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-loc-first-authors.parquet
      --first-author -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 6d6bad45f562085798e8d6731cdd56b1
      size: 330399885
    - path: loc-mds/book-authors.parquet
      md5: 3585eceab422d960e403a2a146bb0b5f
      size: 84128212
    - path: loc-mds/book-isbn-ids.parquet
      md5: 78f2fe5cf9b4dc4770576829e365bb3d
      size: 41912948
    - path: src/cli/cluster
      md5: a6a5f991654c8faa137637ec71f188ce.dir
      size: 15044
      nfiles: 6
    outs:
    - path: book-links/cluster-loc-first-authors.parquet
      md5: 67038e3ff2f9f401941f82e9fc776cba
      size: 51655909
  cluster-irst-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5ee9bb4b67de722e24363e140ea2791f
      size: 161946382
    - path: loc-mds/book-authors.parquet
      md5: 2d3212dbf2405c48fb8bf2587a8587c3
      size: 127567010
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: 76f614625858e7ad84e273e875861490
      size: 5253
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a7f439659cccd809efe4ac2ea276b058
      size: 157637977
  cluster-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 6d6bad45f562085798e8d6731cdd56b1
      size: 330399885
    - path: loc-mds/book-authors.parquet
      md5: 3585eceab422d960e403a2a146bb0b5f
      size: 84128212
    - path: loc-mds/book-isbn-ids.parquet
      md5: 78f2fe5cf9b4dc4770576829e365bb3d
      size: 41912948
    - path: openlibrary/author-names.parquet
      md5: 1af0e26605c0f6b58b9c881d53633622
      size: 149833187
    - path: openlibrary/edition-authors.parquet
      md5: 887d3b1709b880338a9e93ecbeb213f6
      size: 193094588
    - path: openlibrary/edition-isbn-ids.parquet
      md5: e80b638bff4ba31b9407c1522b4de384
      size: 220316416
    - path: src/cli/cluster
      md5: 0463e65d7516ab977458de4bd542b3ae.dir
      size: 15037
      nfiles: 6
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: 6965a8ab1cc45dc35fce897991efd4f5
      size: 304484187
  cluster-genders:
    cmd: python run.py --rust cluster extract-author-gender -o book-links/cluster-genders.parquet
      -A book-links/cluster-first-authors.parquet
    deps:
    - path: book-links/cluster-first-authors.parquet
      md5: 6965a8ab1cc45dc35fce897991efd4f5
      size: 304484187
    - path: book-links/cluster-stats.parquet
      md5: 10d1f8c73928b9f64671f4b927a99d54
      size: 143450830
    - path: src/cli/cluster
      md5: 0463e65d7516ab977458de4bd542b3ae.dir
      size: 15037
      nfiles: 6
    - path: viaf/author-genders.parquet
      md5: 0e94eb2213b74eb4b643378a6b1e06a1
      size: 115088580
    - path: viaf/author-name-index.parquet
      md5: 2a428ffdd62ef51108ffd3475a61f760
      size: 516451746
    outs:
    - path: book-links/cluster-genders.parquet
      md5: 0d4f082d25ba22055ae3064353ccd184
      size: 125958140
  gender-stats:
    cmd: python ../run.py integration-stats.py
    deps:
    - path: ../az2014/az-cluster-ratings.parquet
      md5: ec29072d8341bb5f60089c0c1e75f7d4
      size: 288448243
    - path: ../bx/bx-cluster-actions.parquet
      md5: b7b1f16c6b6a107b6b6a218a63866dc6
      size: 6175087
    - path: ../bx/bx-cluster-ratings.parquet
      md5: 6002f8294d60c0bb0f407e8c03b3f31b
      size: 2751030
    - path: ../goodreads/gr-cluster-actions.parquet
      md5: e613613e003bf16c7ef1917351fb4929
      size: 1498267178
    - path: ../goodreads/gr-cluster-ratings.parquet
      md5: 904a891b61264a23b41db79861981a2e
      size: 1566991672
    - path: ../loc-mds/book-isbn-ids.parquet
      md5: 78f2fe5cf9b4dc4770576829e365bb3d
      size: 41912948
    - path: cluster-genders.parquet
      md5: 0d4f082d25ba22055ae3064353ccd184
      size: 125958140
    - path: integration-stats.py
      md5: 889c8f95bf6e1498bed7190b250589af
      size: 2248
    - path: isbn-clusters.parquet
      md5: 6d6bad45f562085798e8d6731cdd56b1
      size: 330399885
    outs:
    - path: gender-stats.csv
      md5: 72589e493916d2b624578a64640ef82f
      size: 1111
  cluster-hashes:
    cmd: python ../run.py --rust cluster hash -o cluster-hashes.parquet isbn-clusters.parquet
    deps:
    - path: ../src/cli/cluster/hash.rs
      md5: 3985bb6edb6040b1b19ec36b2815b4b2
      size: 2345
    - path: isbn-clusters.parquet
      md5: 6d6bad45f562085798e8d6731cdd56b1
      size: 330399885
    outs:
    - path: cluster-hashes.parquet
      md5: bdcbac7151e1797a48053641bc7df857
      size: 377086573
  debug-graph:
    cmd: python ./run.py --rust extract-graph --cluster 100004141 -o book-links/debug-graph.gml
    deps:
    - path: book-links/book-graph.mp.zst
      md5: cbb067efc568960af703f83f5b73e9ac
      size: 1283174149
    - path: src/bin/extract-graph.rs
      md5: c22a75eb91d779306a11d8bd2065b3e6
      size: 1142
    outs:
    - path: book-links/debug-graph.gml
      md5: b2fb3c4a07ace6f85a1b880b54ab5da8
      size: 2144356
  schema@cluster-stats:
    cmd: python ../run.py --rust pq-info -o cluster-stats.json cluster-stats.parquet
    deps:
    - path: cluster-stats.parquet
      md5: 10d1f8c73928b9f64671f4b927a99d54
      size: 143450830
    outs:
    - path: cluster-stats.json
      md5: e50f52a184485d7ebf6eab6736d5953e
      size: 816
  schema@cluster-first-authors:
    cmd: python ../run.py --rust pq-info -o cluster-first-authors.json cluster-first-authors.parquet
    deps:
    - path: cluster-first-authors.parquet
      md5: a96a019849de7c60ffcfbb2e29e56fc3
      size: 304498886
    outs:
    - path: cluster-first-authors.json
      md5: 52cea8a5c5f4c3af96a4123df34220cf
      size: 254
  schema@cluster-genders:
    cmd: python ../run.py --rust pq-info -o cluster-genders.json cluster-genders.parquet
    deps:
    - path: cluster-genders.parquet
      md5: caae06af2d9c81695d482165ea20a640
      size: 123158827
    outs:
    - path: cluster-genders.json
      md5: 53443a2ade3c33d08e678154783507c7
      size: 249
  schema@all-isbns:
    cmd: python ../run.py --rust pq-info -o all-isbns.json all-isbns.parquet
    deps:
    - path: all-isbns.parquet
      md5: 853ac4693adcb143223a383ef65e69e3
      size: 272956344
    outs:
    - path: all-isbns.json
      md5: 83de52ae858b03aae650b1006f0d4bb3
      size: 675
  schema@cluster-hashes:
    cmd: python ../run.py --rust pq-info -o cluster-hashes.json cluster-hashes.parquet
    deps:
    - path: cluster-hashes.parquet
      md5: bdcbac7151e1797a48053641bc7df857
      size: 377086573
    outs:
    - path: cluster-hashes.json
      md5: 62cc8dd9f267317e3b72beacbcec9816
      size: 344
  schema@isbn-clusters:
    cmd: python ../run.py --rust pq-info -o isbn-clusters.json isbn-clusters.parquet
    deps:
    - path: isbn-clusters.parquet
      md5: 6d6bad45f562085798e8d6731cdd56b1
      size: 330399885
    outs:
    - path: isbn-clusters.json
      md5: 6945d2e1b8510229db20668f18c2fa10
      size: 336
