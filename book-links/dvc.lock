schema: '2.0'
stages:
  collect-isbns:
    cmd: python run.py --rust collect-isbns
    deps:
    - path: az2014/ratings.parquet
      md5: 95cd58874b4a8bb97c9708291501a2f3
      size: 147876996
    - path: bx/cleaned-ratings.csv
      md5: da3196d4af84ae39b3713e73c59677c7
      size: 22627884
    - path: goodreads/gr-book-ids.parquet
      md5: 7fb9d5ee13edd9520edbc6c2bcb02565
      size: 36152176
    - path: loc-mds/book-isbns.parquet
      md5: 0f6f3e5cae82b390c43451040916c087
      size: 54350954
    - path: openlibrary/edition-isbns.parquet
      md5: 5538527022436ea7e99d9dfd22895028
      size: 132775401
    - path: src/bin/collect-isbns.rs
      md5: 622781b36fe4c74d94c22787d8d4ea29
      size: 4166
    outs:
    - path: book-links/all-isbns.parquet
      md5: a20cd5cbf9e45c15b5687f1a087b01ce
      size: 253049623
  cluster:
    cmd: python run.py --rust cluster-books
    deps:
    - path: book-links/all-isbns.parquet
      md5: a20cd5cbf9e45c15b5687f1a087b01ce
      size: 253049623
    - path: goodreads/book-isbn-ids.parquet
      md5: 6888e0645813becca683e5f040e28296
      size: 34927251
    - path: goodreads/gr-book-ids.parquet
      md5: 7fb9d5ee13edd9520edbc6c2bcb02565
      size: 36152176
    - path: loc-mds/book-ids.parquet
      md5: cb26ddb248b9e595577c20b9fca13e4d
      size: 64879592
    - path: loc-mds/book-isbn-ids.parquet
      md5: 8cad8532c9109d6ba2c61160627c547b
      size: 73551347
    - path: openlibrary/all-works.parquet
      md5: 2f011b1ee4a355f005f8e816e456f427
      size: 147843743
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 9e2cab940c53afe22b73e324bbb4c1c7
      size: 226359598
    - path: openlibrary/edition-works.parquet
      md5: 53b2411bb98c5f37f51d3e23b2b6e876
      size: 146525245
    - path: openlibrary/editions.parquet
      md5: 14711ccac136c604e043cadf803cad7e
      size: 725126663
    - path: src/bin/cluster-books.rs
      md5: d49e58b7a543f64b122c4dceb2492506
      size: 4249
    - path: src/graph/
      md5: be3cc19e9d6a55b2efdacac78eb346ee.dir
      size: 10332
      nfiles: 4
    outs:
    - path: book-links/book-graph.mp.zst
      md5: 2e419af93e327edbc2280bfe1f5970f8
      size: 1289756843
    - path: book-links/cluster-graph-edges.parquet
      md5: e433877fca90fea03b4c9aa8d28064ac
      size: 393700317
    - path: book-links/cluster-graph-nodes.parquet
      md5: 2cf4c86bdf20d20d71305eaf7410f04e
      size: 679883668
    - path: book-links/cluster-stats.json
      md5: 5c96ab0a58f29dfa98efb61f36275323
      size: 37
    - path: book-links/cluster-stats.parquet
      md5: 847b60b7436da86b00cceaaf013e667b
      size: 137087558
    - path: book-links/isbn-clusters.parquet
      md5: d0f4e3b90bddfe1b9355f4eda35d6c48
      size: 256561034
  cluster-ol-first-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-ol-first-authors.parquet
      --first-author -s openlib
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: c1b27a37130afa2a02000db6a6f72560
      size: 161947431
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: d32ee6761ce02761550716be04aff6ff
      size: 5058
    outs:
    - path: book-links/cluster-ol-first-authors.parquet
      md5: 904074c232f3b92b06d292a0bf5a59ba
      size: 157503615
  cluster-loc-first-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-loc-first-authors.parquet
      --first-author -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: c1b27a37130afa2a02000db6a6f72560
      size: 161947431
    - path: loc-mds/book-authors.parquet
      md5: 84e80cec0e0df87404a44a03d8d60bf3
      size: 127163262
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: src/bin/cluster-authors.rs
      md5: d32ee6761ce02761550716be04aff6ff
      size: 5058
    outs:
    - path: book-links/cluster-loc-first-authors.parquet
      md5: 7866d20f22fffacbe0775d4ca2e28dba
      size: 58848984
  cluster-irst-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5ee9bb4b67de722e24363e140ea2791f
      size: 161946382
    - path: loc-mds/book-authors.parquet
      md5: 2d3212dbf2405c48fb8bf2587a8587c3
      size: 127567010
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: 76f614625858e7ad84e273e875861490
      size: 5253
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a7f439659cccd809efe4ac2ea276b058
      size: 157637977
  cluster-first-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: f0ef4690501b76ae383f7779dd3d6f64
      size: 256635356
    - path: loc-mds/book-authors.parquet
      md5: b2c7df798fb964086a660671b7dec3b2
      size: 125793481
    - path: loc-mds/book-isbn-ids.parquet
      md5: 8cad8532c9109d6ba2c61160627c547b
      size: 73551347
    - path: openlibrary/author-names.parquet
      md5: c380afae0b1aec42d7fbc1fd25097d00
      size: 126446479
    - path: openlibrary/edition-authors.parquet
      md5: 06d076cd39843ef8daeb4204f4d2fc2b
      size: 136280190
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 9e2cab940c53afe22b73e324bbb4c1c7
      size: 226359598
    - path: src/bin/cluster-authors.rs
      md5: d8bb6ef8de585d8cd2deb2b6dbd17bb0
      size: 5038
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: 11a08ac5611567d422614f32f4191df8
      size: 177741770
  cluster-genders:
    cmd: python run.py --rust cluster-author-gender -o book-links/cluster-genders.parquet
      -A book-links/cluster-first-authors.parquet
    deps:
    - path: book-links/cluster-first-authors.parquet
      md5: 11a08ac5611567d422614f32f4191df8
      size: 177741770
    - path: book-links/cluster-stats.parquet
      md5: 590698f400f54520a6dfd8b9f1513032
      size: 137075854
    - path: src/bin/cluster-author-gender/
      md5: a04a15876bc2eb5ff97448bb73f9792f.dir
      size: 7452
      nfiles: 3
    - path: viaf/author-genders.parquet
      md5: 224af6ab253317960eca161c1847a218
      size: 145605611
    - path: viaf/author-name-index.parquet
      md5: 44f6201811103b9d235dd866d13f2e92
      size: 483829087
    outs:
    - path: book-links/cluster-genders.parquet
      md5: a29b6babf7aecc2a79eb36beec61cf04
      size: 113453494
  gender-stats:
    cmd: python ../run.py --rust fusion integration-stats.tcl
    deps:
    - path: ../az2014/az-cluster-ratings.parquet
      md5: cf3d2c667b999f31b0ca538201289e9d
      size: 302734762
    - path: ../bx/bx-cluster-actions.parquet
      md5: f9eb79a4f4ee76246733fb9a43e7844d
      size: 7249513
    - path: ../bx/bx-cluster-ratings.parquet
      md5: 6d1021a4b8f8763a465cd62ee67a0546
      size: 3043043
    - path: ../goodreads/gr-cluster-actions.parquet
      md5: 603e868728580e0cfeda82bc726db724
      size: 2917451339
    - path: ../goodreads/gr-cluster-ratings.parquet
      md5: 10502497c28cbcf6d0b9e612d98ac4cf
      size: 1400670720
    - path: ../loc-mds/book-isbn-ids.parquet
      md5: 8cad8532c9109d6ba2c61160627c547b
      size: 73551347
    - path: cluster-genders.parquet
      md5: a29b6babf7aecc2a79eb36beec61cf04
      size: 113453494
    - path: integration-stats.tcl
      md5: 8e1047cc209458a45d73986002a43e01
      size: 1794
    - path: isbn-clusters.parquet
      md5: f0ef4690501b76ae383f7779dd3d6f64
      size: 256635356
    outs:
    - path: gender-stats.csv
      md5: 3448e07743a467ae1a823ee6f16edad4
      size: 1114
  cluster-hashes:
    cmd: python cluster-hash.py
    deps:
    - path: cluster-hash.py
      md5: 63af95d34bf99ca5feb58cce4a7715ee
      size: 762
    - path: isbn-clusters.parquet
      md5: 7641cf2bf32b14fdf57f08be8df9d23b
      size: 260471224
    outs:
    - path: cluster-hashes.parquet
      md5: a6d79fc94d5e066a6b14ceecaea29fd9
      size: 239512394
  debug-graph:
    cmd: python ./run.py --rust extract-graph --cluster 100004141 -o book-links/debug-graph.gml
    deps:
    - path: book-links/book-graph.mp.zst
      md5: ae84f67a7c8823065c4297e0b9dd11a8
      size: 783028664
    - path: src/bin/extract-graph.rs
      md5: d322afe79b6a923b0fffbcb3d2b2b328
      size: 1880
    outs:
    - path: book-links/debug-graph.gml
      md5: b56451502c838cb220492dad6dc7d229
      size: 2175506
