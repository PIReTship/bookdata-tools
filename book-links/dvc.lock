schema: '2.0'
stages:
  collect-isbns:
    cmd: python ../run.py --rust collect-isbns -o all-isbns.parquet all-isbns.toml
    deps:
    - path: ../az2014/ratings.parquet
      md5: f3e8018263dadb98a221f7a0fd0f6821
      size: 147804724
    - path: ../az2018/ratings.parquet
      md5: 4b805f7ec1cb430228beb47c37de6409
      size: 337369247
    - path: ../bx/cleaned-ratings.csv
      md5: da3196d4af84ae39b3713e73c59677c7
      size: 22627884
    - path: ../goodreads/gr-book-ids.parquet
      md5: bd138e1db016e3533554f08971ed28eb
      size: 36155423
    - path: ../loc-mds/book-isbns.parquet
      md5: b692a9b00ba567028f566e985e503722
      size: 54291815
    - path: ../openlibrary/edition-isbns.parquet
      md5: 4aae4d3eaf2ff663d71b9965ccf59133
      size: 132821740
    - path: ../src/cli/collect_isbns.rs
      md5: 6cd9a1b90cb1d613ff7ba73c6f8be741
      size: 2911
    - path: all-isbns.toml
      md5: 58da443b1ccfdd3def283c05408179d8
      size: 458
    outs:
    - path: all-isbns.parquet
      md5: bda703683918b4a95a8c030d98ce9568
      size: 200094613
  cluster:
    cmd: python run.py --rust cluster-books
    deps:
    - path: book-links/all-isbns.parquet
      md5: bda703683918b4a95a8c030d98ce9568
      size: 200094613
    - path: goodreads/book-isbn-ids.parquet
      md5: c578d7dd4c54f46d2e460ddacd3b9db2
      size: 19254938
    - path: goodreads/gr-book-ids.parquet
      md5: bd138e1db016e3533554f08971ed28eb
      size: 36155423
    - path: loc-mds/book-ids.parquet
      md5: 7f47ba0c4aa3b202f0f1f93774b40f17
      size: 64587938
    - path: loc-mds/book-isbn-ids.parquet
      md5: a880099c06302b3cf8f54941508b293b
      size: 41682598
    - path: openlibrary/all-works.parquet
      md5: 43534d6324f0021769fdd8ed3287c48b
      size: 147842482
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 05e8a5f22aa9b8d0fd2c78088245c9ad
      size: 131864067
    - path: openlibrary/edition-works.parquet
      md5: 295d170711290ac99b92e60e179bcf7f
      size: 146555043
    - path: openlibrary/editions.parquet
      md5: 48972480e58c663c3feff6e3d698c2ba
      size: 723946186
    - path: src/cli/cluster_books.rs
      md5: beac23c9cf78899baebbfdb8cfcee51c
      size: 4439
    - path: src/graph/
      md5: 9130dffabed6b16ead90ae16b86780dc.dir
      size: 9964
      nfiles: 4
    outs:
    - path: book-links/book-graph.mp.zst
      md5: 3c74290efe942a72f5257ddc310ac7a8
      size: 1150041715
    - path: book-links/cluster-graph-edges.parquet
      md5: 4d724df641590e388ad2463d8f0bfe39
      size: 361239291
    - path: book-links/cluster-graph-nodes.parquet
      md5: 67121a9be444ab56e7f72d61ffab6b24
      size: 630847820
    - path: book-links/cluster-stats.json
      md5: f4f96152ad08e8a2b48184040c768b40
      size: 37
    - path: book-links/cluster-stats.parquet
      md5: 59690f00cd67fbf4eda8366e337728c5
      size: 123221038
    - path: book-links/isbn-clusters.parquet
      md5: 1c356f6d6d26be0917ff5a2a1ce58d68
      size: 238640777
  cluster-ol-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-ol-first-authors.parquet
      --first-author -s openlib
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 1c356f6d6d26be0917ff5a2a1ce58d68
      size: 238640777
    - path: openlibrary/author-names.parquet
      md5: bbe41b19f31882eb0128142b351cc077
      size: 126448846
    - path: openlibrary/edition-authors.parquet
      md5: 52d351f649c6cce481da4b4df6393940
      size: 136280002
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 05e8a5f22aa9b8d0fd2c78088245c9ad
      size: 131864067
    - path: src/cli/cluster
      md5: 5ac10b25260ff8d4e5e4d27cf71d8622.dir
      size: 25125
      nfiles: 11
    outs:
    - path: book-links/cluster-ol-first-authors.parquet
      md5: e4ec812005b0b0f889e9974f761bcdf2
      size: 144485658
  cluster-loc-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-loc-first-authors.parquet
      --first-author -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 1c356f6d6d26be0917ff5a2a1ce58d68
      size: 238640777
    - path: loc-mds/book-authors.parquet
      md5: 8bb05bd8c1cd99c6d7d10b1ab10d6489
      size: 103616710
    - path: loc-mds/book-isbn-ids.parquet
      md5: a880099c06302b3cf8f54941508b293b
      size: 41682598
    - path: src/cli/cluster
      md5: 5ac10b25260ff8d4e5e4d27cf71d8622.dir
      size: 25125
      nfiles: 11
    outs:
    - path: book-links/cluster-loc-first-authors.parquet
      md5: 999526af7e0a0437da1d5f2373d70a3e
      size: 55832309
  cluster-irst-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5ee9bb4b67de722e24363e140ea2791f
      size: 161946382
    - path: loc-mds/book-authors.parquet
      md5: 2d3212dbf2405c48fb8bf2587a8587c3
      size: 127567010
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: 76f614625858e7ad84e273e875861490
      size: 5253
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a7f439659cccd809efe4ac2ea276b058
      size: 157637977
  cluster-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 1c356f6d6d26be0917ff5a2a1ce58d68
      size: 238640777
    - path: loc-mds/book-authors.parquet
      md5: 8bb05bd8c1cd99c6d7d10b1ab10d6489
      size: 103616710
    - path: loc-mds/book-isbn-ids.parquet
      md5: a880099c06302b3cf8f54941508b293b
      size: 41682598
    - path: openlibrary/author-names.parquet
      md5: bbe41b19f31882eb0128142b351cc077
      size: 126448846
    - path: openlibrary/edition-authors.parquet
      md5: 52d351f649c6cce481da4b4df6393940
      size: 136280002
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 05e8a5f22aa9b8d0fd2c78088245c9ad
      size: 131864067
    - path: src/cli/cluster
      md5: 5ac10b25260ff8d4e5e4d27cf71d8622.dir
      size: 25125
      nfiles: 11
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: 8a4e70c56b11b3ff74e4d2c7d9052948
      size: 177735600
  cluster-genders:
    cmd: python run.py --rust cluster extract-author-gender -o book-links/cluster-genders.parquet
      -A book-links/cluster-first-authors.parquet
    deps:
    - path: book-links/cluster-first-authors.parquet
      md5: 8a4e70c56b11b3ff74e4d2c7d9052948
      size: 177735600
    - path: book-links/cluster-stats.parquet
      md5: 59690f00cd67fbf4eda8366e337728c5
      size: 123221038
    - path: src/cli/cluster
      md5: 5ac10b25260ff8d4e5e4d27cf71d8622.dir
      size: 25125
      nfiles: 11
    - path: viaf/author-genders.parquet
      md5: cbd6871e6ba229881aed5f58126fd652
      size: 102791330
    - path: viaf/author-name-index.parquet
      md5: 663023a30c3d2f93ca4dea7d26793e9d
      size: 483832252
    outs:
    - path: book-links/cluster-genders.parquet
      md5: 0a8ae5a6729e16a35d070f9870180d36
      size: 109945682
  gender-stats:
    cmd: python ../run.py --rust fusion integration-stats.tcl
    deps:
    - path: ../az2014/az-cluster-ratings.parquet
      md5: 6c955389b465148eda515a939c359031
      size: 302412969
    - path: ../bx/bx-cluster-actions.parquet
      md5: 6f441bba5ca6b5561f3b64b86a573617
      size: 7260320
    - path: ../bx/bx-cluster-ratings.parquet
      md5: 3530f675348bce9d4577bb28dd29f055
      size: 3047329
    - path: ../goodreads/gr-cluster-actions.parquet
      md5: cf48599b55383c55fc3ecc6a386b7407
      size: 2917244968
    - path: ../goodreads/gr-cluster-ratings.parquet
      md5: 45157beb8a9cf6a55831d07362c14b19
      size: 1400700726
    - path: ../loc-mds/book-isbn-ids.parquet
      md5: a880099c06302b3cf8f54941508b293b
      size: 41682598
    - path: cluster-genders.parquet
      md5: 0a8ae5a6729e16a35d070f9870180d36
      size: 109945682
    - path: integration-stats.tcl
      md5: d0e63bd738d040b37dc3fc0e2500953b
      size: 2197
    - path: isbn-clusters.parquet
      md5: 1c356f6d6d26be0917ff5a2a1ce58d68
      size: 238640777
    outs:
    - path: gender-stats.csv
      md5: a75cf6d6877a6285322ee2352159b2ce
      size: 1338
  cluster-hashes:
    cmd: python ../run.py --rust cluster hash -o cluster-hashes.parquet
    deps:
    - path: ../src/cli/cluster
      md5: 5ac10b25260ff8d4e5e4d27cf71d8622.dir
      size: 25125
      nfiles: 11
    - path: isbn-clusters.parquet
      md5: 1c356f6d6d26be0917ff5a2a1ce58d68
      size: 238640777
    outs:
    - path: cluster-hashes.parquet
      md5: 646ad6c13193261e801cb6f670518bac
      size: 287068522
  debug-graph:
    cmd: python ./run.py --rust extract-graph --cluster 100004141 -o book-links/debug-graph.gml
    deps:
    - path: book-links/book-graph.mp.zst
      md5: cbb067efc568960af703f83f5b73e9ac
      size: 1283174149
    - path: src/bin/extract-graph.rs
      md5: c22a75eb91d779306a11d8bd2065b3e6
      size: 1142
    outs:
    - path: book-links/debug-graph.gml
      md5: b2fb3c4a07ace6f85a1b880b54ab5da8
      size: 2144356
