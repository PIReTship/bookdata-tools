schema: '2.0'
stages:
  collect-isbns:
    cmd: python ../run.py --rust collect-isbns -o all-isbns.parquet all-isbns.toml
    deps:
    - path: ../az2014/ratings.parquet
      md5: 837bfe4ded39ed9e5e5758e9fbb8c7ae
      size: 147930125
    - path: ../bx/cleaned-ratings.csv
      md5: da3196d4af84ae39b3713e73c59677c7
      size: 22627884
    - path: ../goodreads/gr-book-ids.parquet
      md5: bd138e1db016e3533554f08971ed28eb
      size: 36155423
    - path: ../loc-mds/book-isbns.parquet
      md5: 2fa96b645a2a578bdd3004f04a3abeb0
      size: 54259876
    - path: ../openlibrary/edition-isbns.parquet
      md5: 4294e568cbdb63f65b3f3e8104a8b378
      size: 199068181
    - path: ../src/cli/collect_isbns.rs
      md5: 6cd9a1b90cb1d613ff7ba73c6f8be741
      size: 2911
    - path: all-isbns.toml
      md5: 8d1990ca34a435e464021afb3b5fc9ed
      size: 399
    outs:
    - path: all-isbns.parquet
      md5: f6b9fb8398a05d56c012dd4064471470
      size: 253193862
  cluster:
    cmd: python run.py --rust cluster-books
    deps:
    - path: book-links/all-isbns.parquet
      md5: f6b9fb8398a05d56c012dd4064471470
      size: 253193862
    - path: goodreads/book-isbn-ids.parquet
      md5: 4aabb0e7caf711db3863f357355f7c05
      size: 19115272
    - path: goodreads/gr-book-ids.parquet
      md5: bd138e1db016e3533554f08971ed28eb
      size: 36155423
    - path: loc-mds/book-ids.parquet
      md5: f2652363fca6916f022b57594db069ac
      size: 64554967
    - path: loc-mds/book-isbn-ids.parquet
      md5: 43c8ff676ce60812467dc68bfb11a40b
      size: 42789578
    - path: openlibrary/all-works.parquet
      md5: cb67188408808220b15ff5c06f2a5daf
      size: 199519828
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 73963f30f6a567f2fc7ba62f234bddb2
      size: 201134511
    - path: openlibrary/edition-works.parquet
      md5: 46a91309fe45045063c153c77c65347a
      size: 203829866
    - path: openlibrary/editions.parquet
      md5: 2776a6fc1bccffcac68431d06414c620
      size: 980200581
    - path: src/cli/cluster_books.rs
      md5: a7be7a18af7ac92557becf4c84fae075
      size: 4441
    - path: src/graph/
      md5: eaaf19b503f6fff1db4a6360e50f3d64.dir
      size: 10012
      nfiles: 4
    outs:
    - path: book-links/book-graph.mp.zst
      md5: e1ddc4cd53786056edc08ea0cf8ccaec
      size: 1388384895
    - path: book-links/cluster-graph-edges.parquet
      md5: c84f7ea0edb312183044467d47183c7a
      size: 485704778
    - path: book-links/cluster-graph-nodes.parquet
      md5: f1eb9bf3276988a1958d0b6bdd339eeb
      size: 797739654
    - path: book-links/cluster-metrics.json
      md5: 9ffde9c644652e8e3fc87fcdb378e011
      size: 37
    - path: book-links/cluster-stats.parquet
      md5: 3ada08b494362d06b89ce468bc7873b7
      size: 138505626
    - path: book-links/isbn-clusters.parquet
      md5: dc78516fac46ccc0e58b734e52563c47
      size: 311427150
  cluster-ol-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-ol-first-authors.parquet
      --first-author -s openlib
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: dc78516fac46ccc0e58b734e52563c47
      size: 311427150
    - path: openlibrary/author-names.parquet
      md5: bf6b7ed566d875c1659453bf663211d4
      size: 166418847
    - path: openlibrary/edition-authors.parquet
      md5: 50c1e7b2546c4f84b6e3d46892cf9cbb
      size: 195230721
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 73963f30f6a567f2fc7ba62f234bddb2
      size: 201134511
    - path: src/cli/cluster
      md5: a1d600e4111815f34cd366be955d3f8f.dir
      size: 24990
      nfiles: 11
    outs:
    - path: book-links/cluster-ol-first-authors.parquet
      md5: c20128a3ec70899039c8e9bf252427ad
      size: 222300573
  cluster-loc-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-loc-first-authors.parquet
      --first-author -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: dc78516fac46ccc0e58b734e52563c47
      size: 311427150
    - path: loc-mds/book-authors.parquet
      md5: 19829781bb046808ce772eed115e55fb
      size: 102117852
    - path: loc-mds/book-isbn-ids.parquet
      md5: 43c8ff676ce60812467dc68bfb11a40b
      size: 42789578
    - path: src/cli/cluster
      md5: a1d600e4111815f34cd366be955d3f8f.dir
      size: 24990
      nfiles: 11
    outs:
    - path: book-links/cluster-loc-first-authors.parquet
      md5: 5533e13983fb0ca3565552a1299809ab
      size: 56262821
  cluster-irst-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5ee9bb4b67de722e24363e140ea2791f
      size: 161946382
    - path: loc-mds/book-authors.parquet
      md5: 2d3212dbf2405c48fb8bf2587a8587c3
      size: 127567010
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: 76f614625858e7ad84e273e875861490
      size: 5253
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a7f439659cccd809efe4ac2ea276b058
      size: 157637977
  cluster-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: dc78516fac46ccc0e58b734e52563c47
      size: 311427150
    - path: loc-mds/book-authors.parquet
      md5: 19829781bb046808ce772eed115e55fb
      size: 102117852
    - path: loc-mds/book-isbn-ids.parquet
      md5: 43c8ff676ce60812467dc68bfb11a40b
      size: 42789578
    - path: openlibrary/author-names.parquet
      md5: bf6b7ed566d875c1659453bf663211d4
      size: 166418847
    - path: openlibrary/edition-authors.parquet
      md5: 50c1e7b2546c4f84b6e3d46892cf9cbb
      size: 195230721
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 73963f30f6a567f2fc7ba62f234bddb2
      size: 201134511
    - path: src/cli/cluster
      md5: a1d600e4111815f34cd366be955d3f8f.dir
      size: 24990
      nfiles: 11
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: fb2c01122286da6a9245f9c0de936015
      size: 251869802
  cluster-genders:
    cmd: python run.py --rust cluster extract-author-gender -o book-links/cluster-genders.parquet
      -A book-links/cluster-first-authors.parquet
    deps:
    - path: book-links/cluster-first-authors.parquet
      md5: fb2c01122286da6a9245f9c0de936015
      size: 251869802
    - path: book-links/cluster-stats.parquet
      md5: 3ada08b494362d06b89ce468bc7873b7
      size: 138505626
    - path: src/cli/cluster
      md5: a1d600e4111815f34cd366be955d3f8f.dir
      size: 24990
      nfiles: 11
    - path: viaf/author-genders.parquet
      md5: 6f2e84ec0ae6bb81d54e369dda7a91bd
      size: 120612452
    - path: viaf/author-name-index.parquet
      md5: 40217b6d77292231541ac4611ab39ad4
      size: 544152510
    outs:
    - path: book-links/cluster-genders.parquet
      md5: 9a36ceabf406a6930a5cd6b3b1d90f92
      size: 126895725
  gender-stats:
    cmd: python ../run.py --rust fusion integration-stats.tcl
    deps:
    - path: ../az2014/az-cluster-ratings.parquet
      md5: f015c329e0414124071d75dbc99e74a8
      size: 302905471
    - path: ../bx/bx-cluster-actions.parquet
      md5: 7c0933c78585613addd5cc773dc58cd4
      size: 7300439
    - path: ../bx/bx-cluster-ratings.parquet
      md5: c7ae20b597780c63cfafd1cd87f289aa
      size: 3061937
    - path: ../goodreads/gr-cluster-actions.parquet
      md5: b93a9d944fd0daa0eac77181d34a0f7a
      size: 2892082036
    - path: ../goodreads/gr-cluster-ratings.parquet
      md5: e68579a1056843d151aaf53d7ce437f2
      size: 1385735303
    - path: ../loc-mds/book-isbn-ids.parquet
      md5: 43c8ff676ce60812467dc68bfb11a40b
      size: 42789578
    - path: cluster-genders.parquet
      md5: 9a36ceabf406a6930a5cd6b3b1d90f92
      size: 126895725
    - path: integration-stats.tcl
      md5: 0b47c45c920d62c0c476e1eca3b312a5
      size: 1946
    - path: isbn-clusters.parquet
      md5: dc78516fac46ccc0e58b734e52563c47
      size: 311427150
    outs:
    - path: gender-stats.csv
      md5: 9e6c176bf0333db69626336c01e23a1b
      size: 1117
  cluster-hashes:
    cmd: python ../run.py --rust cluster hash -o cluster-hashes.parquet
    deps:
    - path: ../src/cli/cluster
      md5: a1d600e4111815f34cd366be955d3f8f.dir
      size: 24990
      nfiles: 11
    - path: isbn-clusters.parquet
      md5: dc78516fac46ccc0e58b734e52563c47
      size: 311427150
    outs:
    - path: cluster-hashes.parquet
      md5: dee132483277f124ac71d10db658a9b3
      size: 349125980
  debug-graph:
    cmd: python ./run.py --rust extract-graph --cluster 100004141 -o book-links/debug-graph.gml
    deps:
    - path: book-links/book-graph.mp.zst
      md5: cbb067efc568960af703f83f5b73e9ac
      size: 1283174149
    - path: src/bin/extract-graph.rs
      md5: c22a75eb91d779306a11d8bd2065b3e6
      size: 1142
    outs:
    - path: book-links/debug-graph.gml
      md5: b2fb3c4a07ace6f85a1b880b54ab5da8
      size: 2144356
  schema@cluster-stats:
    cmd: python ../run.py --rust pq-info -o cluster-stats.json cluster-stats.parquet
    deps:
    - path: cluster-stats.parquet
      md5: 3ada08b494362d06b89ce468bc7873b7
      size: 138505626
    outs:
    - path: cluster-stats.json
      md5: db8dda2fcebd5236ea8216faeebeadc1
      size: 1232
  schema@cluster-first-authors:
    cmd: python ../run.py --rust pq-info -o cluster-first-authors.json cluster-first-authors.parquet
    deps:
    - path: cluster-first-authors.parquet
      md5: fb2c01122286da6a9245f9c0de936015
      size: 251869802
    outs:
    - path: cluster-first-authors.json
      md5: da34fb4a4893dbe1084b4e9bbebcf557
      size: 358
  schema@cluster-genders:
    cmd: python ../run.py --rust pq-info -o cluster-genders.json cluster-genders.parquet
    deps:
    - path: cluster-genders.parquet
      md5: 9a36ceabf406a6930a5cd6b3b1d90f92
      size: 126895725
    outs:
    - path: cluster-genders.json
      md5: 24a69ef98ea7ce00de8b4c0c3531d63e
      size: 353
  schema@all-isbns:
    cmd: python ../run.py --rust pq-info -o all-isbns.json all-isbns.parquet
    deps:
    - path: all-isbns.parquet
      md5: f6b9fb8398a05d56c012dd4064471470
      size: 253193862
    outs:
    - path: all-isbns.json
      md5: 14c633c8e8d3d835711113084249f829
      size: 1039
  schema@cluster-hashes:
    cmd: python ../run.py --rust pq-info -o cluster-hashes.json cluster-hashes.parquet
    deps:
    - path: cluster-hashes.parquet
      md5: dee132483277f124ac71d10db658a9b3
      size: 349125980
    outs:
    - path: cluster-hashes.json
      md5: 5d37975abb002b01ca99c4b6ca1e3357
      size: 500
  schema@isbn-clusters:
    cmd: python ../run.py --rust pq-info -o isbn-clusters.json isbn-clusters.parquet
    deps:
    - path: isbn-clusters.parquet
      md5: dc78516fac46ccc0e58b734e52563c47
      size: 311427150
    outs:
    - path: isbn-clusters.json
      md5: 7fd1ca39612943a8ee0638eff64a1a9d
      size: 492
