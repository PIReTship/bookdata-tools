schema: '2.0'
stages:
  collect-isbns:
    cmd: python run.py --rust collect-isbns
    deps:
    - path: az2014/ratings.parquet
      md5: 4bad1289c4a2c5c45b094b77f3cb11c3
      size: 147876996
    - path: az2018/ratings.parquet
      md5: fff0cf944e5cafa510f279d041e95946
      size: 337637016
    - path: bx/cleaned-ratings.csv
      md5: da3196d4af84ae39b3713e73c59677c7
      size: 22627884
    - path: goodreads/gr-book-ids.parquet
      md5: 2d887e7c73eeacd0beb672675fbb66e2
      size: 36149035
    - path: loc-mds/book-isbns.parquet
      md5: 0f6f3e5cae82b390c43451040916c087
      size: 54350954
    - path: openlibrary/edition-isbns.parquet
      md5: 5538527022436ea7e99d9dfd22895028
      size: 132775401
    - path: src/cli/collect_isbns.rs
      md5: 3099976c3b70c17c94e01d5bb01da104
      size: 4557
    outs:
    - path: book-links/all-isbns.parquet
      md5: 9a7e56c4625f5ff3d20d9aa9474b0158
      size: 268756905
  cluster:
    cmd: python run.py --rust cluster-books
    deps:
    - path: book-links/all-isbns.parquet
      md5: 9a7e56c4625f5ff3d20d9aa9474b0158
      size: 268756905
    - path: goodreads/book-isbn-ids.parquet
      md5: a0c729088879b444c9911441088127a4
      size: 20865453
    - path: goodreads/gr-book-ids.parquet
      md5: 2d887e7c73eeacd0beb672675fbb66e2
      size: 36149035
    - path: loc-mds/book-ids.parquet
      md5: cb26ddb248b9e595577c20b9fca13e4d
      size: 64879592
    - path: loc-mds/book-isbn-ids.parquet
      md5: 470487ca861b3764ff408b99cd558287
      size: 51725014
    - path: openlibrary/all-works.parquet
      md5: a5f02bafa1848402af6058cbab7beb58
      size: 147845845
    - path: openlibrary/edition-isbn-ids.parquet
      md5: fa653547af17338d4726af1e7fad8027
      size: 155468600
    - path: openlibrary/edition-works.parquet
      md5: 53b2411bb98c5f37f51d3e23b2b6e876
      size: 146525245
    - path: openlibrary/editions.parquet
      md5: 14711ccac136c604e043cadf803cad7e
      size: 725126663
    - path: src/cli/cluster_books.rs
      md5: d6a3c3ec806ffebdbe6eea7d8020ff90
      size: 4568
    - path: src/graph/
      md5: 9130dffabed6b16ead90ae16b86780dc.dir
      size: 10338
      nfiles: 4
    outs:
    - path: book-links/book-graph.mp.zst
      md5: 8c2a845ab5d3be012387057e31299b5b
      size: 1296330334
    - path: book-links/cluster-graph-edges.parquet
      md5: b71b43a99ea0ad6e5aec42ff287571f4
      size: 390551446
    - path: book-links/cluster-graph-nodes.parquet
      md5: 7ccaf23685fb565d8078edf84071b801
      size: 694232924
    - path: book-links/cluster-stats.json
      md5: f4f96152ad08e8a2b48184040c768b40
      size: 37
    - path: book-links/cluster-stats.parquet
      md5: c05585202577362943fdf40217cb9b20
      size: 144060908
    - path: book-links/isbn-clusters.parquet
      md5: febea209f56e4943297e1db74405a061
      size: 269220108
  cluster-ol-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-ol-first-authors.parquet
      --first-author -s openlib
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 6ecc86af09058a12b66b4e99a981e887
      size: 257357014
    - path: openlibrary/author-names.parquet
      md5: c380afae0b1aec42d7fbc1fd25097d00
      size: 126446479
    - path: openlibrary/edition-authors.parquet
      md5: 06d076cd39843ef8daeb4204f4d2fc2b
      size: 136280190
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 556b9250f657673e8127223fb194dd23
      size: 155454698
    - path: src/cli/cluster
      md5: 056f238677f83040450813b1376b21e3.dir
      size: 24282
      nfiles: 11
    outs:
    - path: book-links/cluster-ol-first-authors.parquet
      md5: 3d55e1004ce424a02075d60d492b58fd
      size: 144474982
  cluster-loc-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-loc-first-authors.parquet
      --first-author -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 6ecc86af09058a12b66b4e99a981e887
      size: 257357014
    - path: loc-mds/book-authors.parquet
      md5: 4cdf63248f24c8cabe7ddf8aed74547c
      size: 103944306
    - path: loc-mds/book-isbn-ids.parquet
      md5: 13621574221ceba03b8ad51b8a5277ab
      size: 51761737
    - path: src/cli/cluster
      md5: 056f238677f83040450813b1376b21e3.dir
      size: 24282
      nfiles: 11
    outs:
    - path: book-links/cluster-loc-first-authors.parquet
      md5: ae8544ba4d61e03685d4218cf3b52a30
      size: 55837080
  cluster-irst-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5ee9bb4b67de722e24363e140ea2791f
      size: 161946382
    - path: loc-mds/book-authors.parquet
      md5: 2d3212dbf2405c48fb8bf2587a8587c3
      size: 127567010
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: 76f614625858e7ad84e273e875861490
      size: 5253
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a7f439659cccd809efe4ac2ea276b058
      size: 157637977
  cluster-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 6ecc86af09058a12b66b4e99a981e887
      size: 257357014
    - path: loc-mds/book-authors.parquet
      md5: 4cdf63248f24c8cabe7ddf8aed74547c
      size: 103944306
    - path: loc-mds/book-isbn-ids.parquet
      md5: 13621574221ceba03b8ad51b8a5277ab
      size: 51761737
    - path: openlibrary/author-names.parquet
      md5: c380afae0b1aec42d7fbc1fd25097d00
      size: 126446479
    - path: openlibrary/edition-authors.parquet
      md5: 06d076cd39843ef8daeb4204f4d2fc2b
      size: 136280190
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 556b9250f657673e8127223fb194dd23
      size: 155454698
    - path: src/cli/cluster
      md5: 056f238677f83040450813b1376b21e3.dir
      size: 24282
      nfiles: 11
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: 763ee699f9df2b6991a7890938b14645
      size: 177743343
  cluster-genders:
    cmd: python run.py --rust cluster extract-author-gender -o book-links/cluster-genders.parquet
      -A book-links/cluster-first-authors.parquet
    deps:
    - path: book-links/cluster-first-authors.parquet
      md5: 763ee699f9df2b6991a7890938b14645
      size: 177743343
    - path: book-links/cluster-stats.parquet
      md5: fe63db951b85f6b7126005d2418ba807
      size: 138794468
    - path: src/cli/cluster
      md5: 056f238677f83040450813b1376b21e3.dir
      size: 24282
      nfiles: 11
    - path: viaf/author-genders.parquet
      md5: d44250d50199492e92cd67afac0610df
      size: 103296580
    - path: viaf/author-name-index.parquet
      md5: 5253753bc679c2adaed69072a13852e7
      size: 483852211
    outs:
    - path: book-links/cluster-genders.parquet
      md5: faf6392fcf4e1074251b6b74c688b221
      size: 115855267
  gender-stats:
    cmd: python ../run.py --rust fusion integration-stats.tcl
    deps:
    - path: ../az2014/az-cluster-ratings.parquet
      md5: a3f8726299a9122e98bfa141c0a6e891
      size: 302830279
    - path: ../bx/bx-cluster-actions.parquet
      md5: 709e4d2cbdcb7a94e52b4373564b3f27
      size: 7249458
    - path: ../bx/bx-cluster-ratings.parquet
      md5: f62dc67ec6edc7d04e75bd2160e23205
      size: 3043656
    - path: ../goodreads/gr-cluster-actions.parquet
      md5: be5e56cdc6d714404238aa864378e250
      size: 2917509726
    - path: ../goodreads/gr-cluster-ratings.parquet
      md5: 66432918ae7d824d03ee5756e34bfe1f
      size: 1400691227
    - path: ../loc-mds/book-isbn-ids.parquet
      md5: 13621574221ceba03b8ad51b8a5277ab
      size: 51761737
    - path: cluster-genders.parquet
      md5: faf6392fcf4e1074251b6b74c688b221
      size: 115855267
    - path: integration-stats.tcl
      md5: 0b47c45c920d62c0c476e1eca3b312a5
      size: 1946
    - path: isbn-clusters.parquet
      md5: 6ecc86af09058a12b66b4e99a981e887
      size: 257357014
    outs:
    - path: gender-stats.csv
      md5: 55312566d75cb5ecf61f5fbf4e704b8c
      size: 1115
  cluster-hashes:
    cmd: python ../run.py --rust cluster hash -o cluster-hashes.parquet
    deps:
    - path: ../src/cli/cluster
      md5: 056f238677f83040450813b1376b21e3.dir
      size: 24282
      nfiles: 11
    - path: isbn-clusters.parquet
      md5: 6ecc86af09058a12b66b4e99a981e887
      size: 257357014
    outs:
    - path: cluster-hashes.parquet
      md5: 498ce9340b01232cfb84377516d1f20c
      size: 269667890
  debug-graph:
    cmd: python ./run.py --rust extract-graph --cluster 100004141 -o book-links/debug-graph.gml
    deps:
    - path: book-links/book-graph.mp.zst
      md5: cbb067efc568960af703f83f5b73e9ac
      size: 1283174149
    - path: src/bin/extract-graph.rs
      md5: c22a75eb91d779306a11d8bd2065b3e6
      size: 1142
    outs:
    - path: book-links/debug-graph.gml
      md5: b2fb3c4a07ace6f85a1b880b54ab5da8
      size: 2144356
