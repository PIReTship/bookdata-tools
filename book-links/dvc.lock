schema: '2.0'
stages:
  collect-isbns:
    cmd: cargo run --release -- collect-isbns -o all-isbns.parquet
    deps:
    - path: ../az2014/ratings.parquet
      hash: md5
      md5: 2c5d3e5876a1d580e003b5c83e8772e0
      size: 149134053
    - path: ../az2018/ratings.parquet
      hash: md5
      md5: fdc3832ac453570056ca27500f9d4033
      size: 342486205
    - path: ../bx/cleaned-ratings.csv
      md5: e2c423d665fb5271def51d358c8c285c
      size: 22627335
    - path: ../config.yaml
      hash: md5
      md5: 5bfbc3fa465aa89a9756e56a75962767
      size: 1461
    - path: ../goodreads/gr-book-ids.parquet
      hash: md5
      md5: 3d5d5d8435d1db19a218be147386ca54
      size: 37731621
    - path: ../loc-mds/book-isbns.parquet
      hash: md5
      md5: a954fd606bfcc6ff9db66af964dd2239
      size: 57538194
    - path: ../openlibrary/edition-isbns.parquet
      hash: md5
      md5: f18c8a73291b23ab591aa564741358bb
      size: 302941724
    - path: ../src/cli/collect_isbns.rs
      hash: md5
      md5: e903a0fbb08eaa2331059d7f417da237
      size: 5282
    outs:
    - path: all-isbns.parquet
      hash: md5
      md5: 60ce328c8aa4e03e8cf9625286b39c54
      size: 468979720
  cluster:
    cmd: cargo run --release -- cluster-books --save-graph book-links/book-graph.mp.zst
    deps:
    - path: book-links/all-isbns.parquet
      hash: md5
      md5: 60ce328c8aa4e03e8cf9625286b39c54
      size: 468979720
    - path: goodreads/book-isbn-ids.parquet
      hash: md5
      md5: 95df1aab4ba3046c85d5ab4351aaa4ab
      size: 16210202
    - path: goodreads/gr-book-ids.parquet
      hash: md5
      md5: 3d5d5d8435d1db19a218be147386ca54
      size: 37731621
    - path: loc-mds/book-ids.parquet
      hash: md5
      md5: c2651736c069b5836563de8028815deb
      size: 71130687
    - path: loc-mds/book-isbn-ids.parquet
      hash: md5
      md5: 033ff75d2d718148c64d7b2a6acbb8a9
      size: 39831327
    - path: openlibrary/all-works.parquet
      hash: md5
      md5: d512ffc2007bda5d79a96d0032f06707
      size: 238048432
    - path: openlibrary/edition-isbn-ids.parquet
      hash: md5
      md5: 59b32b9ffa07179573b231108025ae5d
      size: 225615545
    - path: openlibrary/edition-works.parquet
      hash: md5
      md5: e4fe7847ecd3c107ec0e75159c71e220
      size: 288359776
    - path: openlibrary/editions.parquet
      hash: md5
      md5: 21dd5b67ba0b062cdfd2b89f4eaeea83
      size: 1193396242
    - path: src/cli/cluster_books.rs
      hash: md5
      md5: e3624b6e04ec2f4bf9eb07e98a16768b
      size: 5669
    - path: src/graph/
      hash: md5
      md5: 62015d75d50e38bcd2ad112230c70fb4.dir
      size: 10418
      nfiles: 4
    outs:
    - path: book-links/book-graph.mp.zst
      hash: md5
      md5: 25316933b94bc6dc7a98f77f640ebf95
      size: 1860748926
    - path: book-links/cluster-graph-edges.parquet
      hash: md5
      md5: c60734da1ce7286988b4dcedb29bb334
      size: 602479501
    - path: book-links/cluster-graph-nodes.parquet
      hash: md5
      md5: 93818a1f4f34c30e989aace6b0277d05
      size: 1213912496
    - path: book-links/cluster-metrics.json
      hash: md5
      md5: 692fcae2b5ab8ea09ee7810006eeb91a
      size: 38
    - path: book-links/cluster-stats.parquet
      hash: md5
      md5: ef7a96d55afed6e31170ec808217dbb9
      size: 231532086
    - path: book-links/isbn-clusters.parquet
      hash: md5
      md5: 857c67a7d5d0e67c2bd46abf56b17dac
      size: 485821518
  cluster-ol-first-authors:
    cmd: cargo run --release -- cluster extract-authors -o book-links/cluster-ol-first-authors.parquet
      --first-author -s openlib
    deps:
    - path: book-links/isbn-clusters.parquet
      hash: md5
      md5: 857c67a7d5d0e67c2bd46abf56b17dac
      size: 485821518
    - path: openlibrary/author-names.parquet
      hash: md5
      md5: 8db9f14b3de99d45d7c32d920619e586
      size: 201987938
    - path: openlibrary/edition-authors.parquet
      hash: md5
      md5: f3a1e8b83acd89e945545c8b3fedc4b7
      size: 283959906
    - path: openlibrary/edition-isbn-ids.parquet
      hash: md5
      md5: 59b32b9ffa07179573b231108025ae5d
      size: 225615545
    - path: src/cli/cluster
      hash: md5
      md5: 00ad8ca02fb9fa0acec15b01fe5e523b.dir
      size: 18494
      nfiles: 7
    outs:
    - path: book-links/cluster-ol-first-authors.parquet
      hash: md5
      md5: e6908b39a62d00a67d6c2f0eeebfb4a0
      size: 400973949
  cluster-loc-first-authors:
    cmd: cargo run --release -- cluster extract-authors -o book-links/cluster-loc-first-authors.parquet
      --first-author -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      hash: md5
      md5: 857c67a7d5d0e67c2bd46abf56b17dac
      size: 485821518
    - path: loc-mds/book-authors.parquet
      hash: md5
      md5: 0994ad02a21d496e6ff14c7001147f67
      size: 88233101
    - path: loc-mds/book-isbn-ids.parquet
      hash: md5
      md5: 033ff75d2d718148c64d7b2a6acbb8a9
      size: 39831327
    - path: src/cli/cluster
      hash: md5
      md5: 00ad8ca02fb9fa0acec15b01fe5e523b.dir
      size: 18494
      nfiles: 7
    outs:
    - path: book-links/cluster-loc-first-authors.parquet
      hash: md5
      md5: 3736c42b0f054715dfdaf20a18161e3b
      size: 52346772
  cluster-irst-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5ee9bb4b67de722e24363e140ea2791f
      size: 161946382
    - path: loc-mds/book-authors.parquet
      md5: 2d3212dbf2405c48fb8bf2587a8587c3
      size: 127567010
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: 76f614625858e7ad84e273e875861490
      size: 5253
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a7f439659cccd809efe4ac2ea276b058
      size: 157637977
  cluster-first-authors:
    cmd: cargo run --release -- cluster extract-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      hash: md5
      md5: 857c67a7d5d0e67c2bd46abf56b17dac
      size: 485821518
    - path: loc-mds/book-authors.parquet
      hash: md5
      md5: 0994ad02a21d496e6ff14c7001147f67
      size: 88233101
    - path: loc-mds/book-isbn-ids.parquet
      hash: md5
      md5: 033ff75d2d718148c64d7b2a6acbb8a9
      size: 39831327
    - path: openlibrary/author-names.parquet
      hash: md5
      md5: 8db9f14b3de99d45d7c32d920619e586
      size: 201987938
    - path: openlibrary/edition-authors.parquet
      hash: md5
      md5: f3a1e8b83acd89e945545c8b3fedc4b7
      size: 283959906
    - path: openlibrary/edition-isbn-ids.parquet
      hash: md5
      md5: 59b32b9ffa07179573b231108025ae5d
      size: 225615545
    - path: src/cli/cluster
      hash: md5
      md5: 00ad8ca02fb9fa0acec15b01fe5e523b.dir
      size: 18494
      nfiles: 7
    outs:
    - path: book-links/cluster-first-authors.parquet
      hash: md5
      md5: 94d088e689d8ce7941f7914576263f04
      size: 454225191
  cluster-genders:
    cmd: cargo run --release -- cluster extract-author-gender -o book-links/cluster-genders.parquet
      -A book-links/cluster-first-authors.parquet
    deps:
    - path: book-links/cluster-first-authors.parquet
      hash: md5
      md5: 94d088e689d8ce7941f7914576263f04
      size: 454225191
    - path: book-links/cluster-stats.parquet
      hash: md5
      md5: ef7a96d55afed6e31170ec808217dbb9
      size: 231532086
    - path: src/cli/cluster
      hash: md5
      md5: 00ad8ca02fb9fa0acec15b01fe5e523b.dir
      size: 18494
      nfiles: 7
    - path: viaf/author-genders.parquet
      hash: md5
      md5: 91edf72ba552e3a7211d433075dad429
      size: 134125115
    - path: viaf/author-name-index.parquet
      hash: md5
      md5: 4714cf57e5d47f6139548750feeb0c52
      size: 561223554
    outs:
    - path: book-links/cluster-genders.parquet
      hash: md5
      md5: 8f2493c32c46cb84874514f13b30ab16
      size: 178012999
  gender-stats:
    cmd: cargo run --release -- integration-stats
    deps:
    - path: az2014/az-cluster-ratings.parquet
      hash: md5
      md5: 4e803a55e40692b3687ef8fc5535d89a
      size: 203417193
    - path: az2018/az-cluster-ratings.parquet
      hash: md5
      md5: f4d5e5176ebead631645183c5e37da10
      size: 452325175
    - path: book-links/cluster-genders.parquet
      hash: md5
      md5: 8f2493c32c46cb84874514f13b30ab16
      size: 178012999
    - path: book-links/isbn-clusters.parquet
      hash: md5
      md5: 857c67a7d5d0e67c2bd46abf56b17dac
      size: 485821518
    - path: bx/bx-cluster-actions.parquet
      hash: md5
      md5: 804caa94583e55f42f7e1a24bae47629
      size: 6705931
    - path: bx/bx-cluster-ratings.parquet
      hash: md5
      md5: ab07160c2744c18415d38f9946c4b9f6
      size: 2888431
    - path: goodreads/simple/gr-cluster-actions.parquet
      hash: md5
      md5: ad24e55b4ca2fabf25c852ebf9fa7206
      size: 1115150931
    - path: goodreads/simple/gr-cluster-ratings.parquet
      hash: md5
      md5: 03d70f08836642819c5470c5a078f4b5
      size: 575296325
    - path: loc-mds/book-isbn-ids.parquet
      hash: md5
      md5: 033ff75d2d718148c64d7b2a6acbb8a9
      size: 39831327
    - path: src/cli/stats.rs
      hash: md5
      md5: 734be329d1fee6189f1bff582766c4be
      size: 3477
    outs:
    - path: book-links/gender-stats.csv
      hash: md5
      md5: ff68a47d3d2b6d327197a4ecd36a5976
      size: 1338
  cluster-hashes:
    cmd: cargo run --release -- cluster hash -o cluster-hashes.parquet isbn-clusters.parquet
    deps:
    - path: ../src/cli/cluster/hash.rs
      hash: md5
      md5: 78ae80ab04a5208975fb1c1abdd9722e
      size: 2466
    - path: isbn-clusters.parquet
      hash: md5
      md5: 857c67a7d5d0e67c2bd46abf56b17dac
      size: 485821518
    outs:
    - path: cluster-hashes.parquet
      hash: md5
      md5: e3b4c3b961000511fd47b2e0b7857eaa
      size: 542967973
  debug-graph:
    cmd: python ./run.py --rust extract-graph --cluster 100004141 -o book-links/debug-graph.gml
    deps:
    - path: book-links/book-graph.mp.zst
      md5: cbb067efc568960af703f83f5b73e9ac
      size: 1283174149
    - path: src/bin/extract-graph.rs
      md5: c22a75eb91d779306a11d8bd2065b3e6
      size: 1142
    outs:
    - path: book-links/debug-graph.gml
      md5: b2fb3c4a07ace6f85a1b880b54ab5da8
      size: 2144356
  schema@cluster-stats:
    cmd: python ../run.py --rust pq-info -o cluster-stats.json cluster-stats.parquet
    deps:
    - path: cluster-stats.parquet
      md5: a150ac1de5a09aa134485ca4f51dc239
      size: 141044160
    outs:
    - path: cluster-stats.json
      md5: a533037fe032a61424b5a63a0f7fcc05
      size: 816
  schema@cluster-first-authors:
    cmd: python ../run.py --rust pq-info -o cluster-first-authors.json cluster-first-authors.parquet
    deps:
    - path: cluster-first-authors.parquet
      md5: 71eb6ee9c09ea07e81d30bfe0852ae62
      size: 311491781
    outs:
    - path: cluster-first-authors.json
      md5: 5534f63f6f2c20f772a4c3943c9fb68c
      size: 254
  schema@cluster-genders:
    cmd: python ../run.py --rust pq-info -o cluster-genders.json cluster-genders.parquet
    deps:
    - path: cluster-genders.parquet
      md5: 63f769c2ab90b6eeca4511eef74aa17f
      size: 128381977
    outs:
    - path: cluster-genders.json
      md5: efd21c3df58cf4a481436f684a2481ea
      size: 249
  schema@all-isbns:
    cmd: python ../run.py --rust pq-info -o all-isbns.json all-isbns.parquet
    deps:
    - path: all-isbns.parquet
      md5: 4ee11717e5f2c80281d9d43cf8c8a0ce
      size: 268553025
    outs:
    - path: all-isbns.json
      md5: 2c8c9a7638942210e76e166498686c47
      size: 762
  schema@cluster-hashes:
    cmd: python ../run.py --rust pq-info -o cluster-hashes.json cluster-hashes.parquet
    deps:
    - path: cluster-hashes.parquet
      md5: 4d3fbcb580e960e8755c99d7ade44cbc
      size: 393915650
    outs:
    - path: cluster-hashes.json
      md5: 0eacbcdd2c62ea1e74f07c60f3142e6c
      size: 344
  schema@isbn-clusters:
    cmd: python ../run.py --rust pq-info -o isbn-clusters.json isbn-clusters.parquet
    deps:
    - path: isbn-clusters.parquet
      md5: 0d0a9af2c4c2693265430e538416c7ec
      size: 330611338
    outs:
    - path: isbn-clusters.json
      md5: bbf1815e3cbeba7fde817f2dd770e320
      size: 336
