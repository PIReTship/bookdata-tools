schema: '2.0'
stages:
  collect-isbns:
    cmd: cargo run --release -- collect-isbns -o all-isbns.parquet
    deps:
    - path: ../az2014/ratings.parquet
      hash: md5
      md5: 640dc71afb5ae836db38343cc14eea3d
      size: 137967960
    - path: ../az2018/ratings.parquet
      hash: md5
      md5: 04a1ef29b26cb2aad8958f8402fc9197
      size: 317105434
    - path: ../bx/cleaned-ratings.csv
      md5: e2c423d665fb5271def51d358c8c285c
      size: 22627335
    - path: ../config.yaml
      hash: md5
      md5: ef434fc02d1b1c4794afc7c063816860
      size: 580
    - path: ../goodreads/gr-book-ids.parquet
      hash: md5
      md5: c89ff21e852c3a1efd6e57e81e1dd238
      size: 37498028
    - path: ../loc-mds/book-isbns.parquet
      hash: md5
      md5: 95111e9718380a0655404de7f43670c2
      size: 55680857
    - path: ../openlibrary/edition-isbns.parquet
      hash: md5
      md5: e533f9d4e4eadae82021cdb80c0b2520
      size: 281141314
    - path: ../src/cli/collect_isbns.rs
      hash: md5
      md5: e903a0fbb08eaa2331059d7f417da237
      size: 5282
    outs:
    - path: all-isbns.parquet
      hash: md5
      md5: 4ed16c671094141776240a6306c25065
      size: 455266795
  cluster:
    cmd: cargo run --release -- cluster-books --save-graph book-links/book-graph.mp.zst
    deps:
    - path: book-links/all-isbns.parquet
      hash: md5
      md5: 4ed16c671094141776240a6306c25065
      size: 455266795
    - path: goodreads/book-isbn-ids.parquet
      hash: md5
      md5: f5365a898c87477a25c45b5bc5db01ec
      size: 16210798
    - path: goodreads/gr-book-ids.parquet
      hash: md5
      md5: c89ff21e852c3a1efd6e57e81e1dd238
      size: 37498028
    - path: loc-mds/book-ids.parquet
      hash: md5
      md5: 402eb6fdc24ea8ab938bf5e7d94da25b
      size: 65210771
    - path: loc-mds/book-isbn-ids.parquet
      hash: md5
      md5: 8961ced644158c407c6db27f7dc50b6e
      size: 39796891
    - path: openlibrary/all-works.parquet
      hash: md5
      md5: 91c558ae2e4e068462de9c9030d9a727
      size: 231626739
    - path: openlibrary/edition-isbn-ids.parquet
      hash: md5
      md5: d37d6f8f8024403e8025c751d6769101
      size: 217056250
    - path: openlibrary/edition-works.parquet
      hash: md5
      md5: 0e5055fbde9787ee158d81cfd5b58a98
      size: 268152871
    - path: openlibrary/editions.parquet
      hash: md5
      md5: 0ebb398c608d3c2e0551d666d4521156
      size: 1147033273
    - path: src/cli/cluster_books.rs
      hash: md5
      md5: 3246d9d48c54d1dedd9014b2266c4f88
      size: 5741
    - path: src/graph/
      hash: md5
      md5: 62015d75d50e38bcd2ad112230c70fb4.dir
      size: 10418
      nfiles: 4
    outs:
    - path: book-links/book-graph.mp.zst
      hash: md5
      md5: 214e2a761ff624aa47ee98493281b162
      size: 1808680128
    - path: book-links/cluster-graph-edges.parquet
      hash: md5
      md5: 94519423382ec7d070345815c1d99b3f
      size: 558971116
    - path: book-links/cluster-graph-nodes.parquet
      hash: md5
      md5: b63cddc195ec68cdff7d650f3d259862
      size: 1132145851
    - path: book-links/cluster-metrics.json
      hash: md5
      md5: 1568b4815353c6d57211e9b6f17139da
      size: 37
    - path: book-links/cluster-stats.parquet
      hash: md5
      md5: ce9863a463fea7e3005a1b1c000efcf1
      size: 186604603
    - path: book-links/isbn-clusters.parquet
      hash: md5
      md5: 95f27640494f2fb494c618a4cb5f8eba
      size: 460145129
  cluster-ol-first-authors:
    cmd: cargo run --release -- cluster extract-authors -o book-links/cluster-ol-first-authors.parquet
      --first-author -s openlib
    deps:
    - path: book-links/isbn-clusters.parquet
      hash: md5
      md5: 95f27640494f2fb494c618a4cb5f8eba
      size: 460145129
    - path: openlibrary/author-names.parquet
      hash: md5
      md5: 6b55d219d470a5392778820669fcf624
      size: 190470493
    - path: openlibrary/edition-authors.parquet
      hash: md5
      md5: f2c4b5f86ed4d5ea0b7ac9bf3d27300d
      size: 257904518
    - path: openlibrary/edition-isbn-ids.parquet
      hash: md5
      md5: d37d6f8f8024403e8025c751d6769101
      size: 217056250
    - path: src/cli/cluster
      hash: md5
      md5: 2ef884ed1fcca881e822beefd848d930.dir
      size: 19098
      nfiles: 7
    outs:
    - path: book-links/cluster-ol-first-authors.parquet
      hash: md5
      md5: 49045726d87c8dc1d617385d4a1ef1ee
      size: 340424786
  cluster-loc-first-authors:
    cmd: cargo run --release -- cluster extract-authors -o book-links/cluster-loc-first-authors.parquet
      --first-author -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      hash: md5
      md5: 95f27640494f2fb494c618a4cb5f8eba
      size: 460145129
    - path: loc-mds/book-authors.parquet
      hash: md5
      md5: 4fac5198a8971591a939767379c88b1e
      size: 85290815
    - path: loc-mds/book-isbn-ids.parquet
      hash: md5
      md5: 8961ced644158c407c6db27f7dc50b6e
      size: 39796891
    - path: src/cli/cluster
      hash: md5
      md5: 2ef884ed1fcca881e822beefd848d930.dir
      size: 19098
      nfiles: 7
    outs:
    - path: book-links/cluster-loc-first-authors.parquet
      hash: md5
      md5: 78c33f4e94bb39e6c13ac2e519a4ca1d
      size: 51287584
  cluster-irst-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5ee9bb4b67de722e24363e140ea2791f
      size: 161946382
    - path: loc-mds/book-authors.parquet
      md5: 2d3212dbf2405c48fb8bf2587a8587c3
      size: 127567010
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: 76f614625858e7ad84e273e875861490
      size: 5253
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a7f439659cccd809efe4ac2ea276b058
      size: 157637977
  cluster-first-authors:
    cmd: cargo run --release -- cluster extract-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      hash: md5
      md5: 95f27640494f2fb494c618a4cb5f8eba
      size: 460145129
    - path: loc-mds/book-authors.parquet
      hash: md5
      md5: 4fac5198a8971591a939767379c88b1e
      size: 85290815
    - path: loc-mds/book-isbn-ids.parquet
      hash: md5
      md5: 8961ced644158c407c6db27f7dc50b6e
      size: 39796891
    - path: openlibrary/author-names.parquet
      hash: md5
      md5: 6b55d219d470a5392778820669fcf624
      size: 190470493
    - path: openlibrary/edition-authors.parquet
      hash: md5
      md5: f2c4b5f86ed4d5ea0b7ac9bf3d27300d
      size: 257904518
    - path: openlibrary/edition-isbn-ids.parquet
      hash: md5
      md5: d37d6f8f8024403e8025c751d6769101
      size: 217056250
    - path: src/cli/cluster
      hash: md5
      md5: 2ef884ed1fcca881e822beefd848d930.dir
      size: 19098
      nfiles: 7
    outs:
    - path: book-links/cluster-first-authors.parquet
      hash: md5
      md5: 36c5d4caa95cdf22ff1d36f553f2c93f
      size: 390192271
  cluster-genders:
    cmd: cargo run --release -- cluster extract-author-gender -o book-links/cluster-genders.parquet
      -A book-links/cluster-first-authors.parquet
    deps:
    - path: book-links/cluster-first-authors.parquet
      hash: md5
      md5: 36c5d4caa95cdf22ff1d36f553f2c93f
      size: 390192271
    - path: book-links/cluster-stats.parquet
      hash: md5
      md5: ce9863a463fea7e3005a1b1c000efcf1
      size: 186604603
    - path: src/cli/cluster
      hash: md5
      md5: 2ef884ed1fcca881e822beefd848d930.dir
      size: 19098
      nfiles: 7
    - path: viaf/author-genders.parquet
      hash: md5
      md5: 260c169cd774ae65713a886814b424d9
      size: 122179668
    - path: viaf/author-name-index.parquet
      hash: md5
      md5: 1cb4487d67c6f8e25ce10d8a78222143
      size: 539865647
    outs:
    - path: book-links/cluster-genders.parquet
      hash: md5
      md5: ee62d569f0578c078858419582c87009
      size: 163703305
  gender-stats:
    cmd: cargo run --release -- integration-stats
    deps:
    - path: az2014/az-cluster-ratings.parquet
      hash: md5
      md5: 5568920ed96e6eb4df763106d33a8c75
      size: 187270617
    - path: az2018/az-cluster-ratings.parquet
      hash: md5
      md5: 83ac6585d174fcbfb96ac72954bf9e73
      size: 420717739
    - path: book-links/cluster-genders.parquet
      hash: md5
      md5: ee62d569f0578c078858419582c87009
      size: 163703305
    - path: book-links/isbn-clusters.parquet
      hash: md5
      md5: 95f27640494f2fb494c618a4cb5f8eba
      size: 460145129
    - path: bx/bx-cluster-actions.parquet
      hash: md5
      md5: 746a28d878d96bf025fb25ded27ac64f
      size: 5407363
    - path: bx/bx-cluster-ratings.parquet
      hash: md5
      md5: 0ada0cbe28bb597a25353c003d3199e9
      size: 2500188
    - path: goodreads/gr-cluster-actions.parquet
      hash: md5
      md5: 9346c080e474de42362d02d96c8f03bf
      size: 925579184
    - path: goodreads/gr-cluster-ratings.parquet
      hash: md5
      md5: 51ecbc28ea26325fd24dc33f7d1a7e4d
      size: 443556060
    - path: loc-mds/book-isbn-ids.parquet
      hash: md5
      md5: 8961ced644158c407c6db27f7dc50b6e
      size: 39796891
    - path: src/cli/stats.rs
      hash: md5
      md5: 12c492b0f6ad11b33f2846791397a1b1
      size: 3364
    outs:
    - path: book-links/gender-stats.csv
      hash: md5
      md5: 38d814d066dfab872ee66a0dfd1bbe8e
      size: 1339
  cluster-hashes:
    cmd: cargo run --release -- cluster hash -o cluster-hashes.parquet isbn-clusters.parquet
    deps:
    - path: ../src/cli/cluster/hash.rs
      md5: ef2834f7770f076609cb7537cce9b58d
      size: 2526
    - path: isbn-clusters.parquet
      hash: md5
      md5: 95f27640494f2fb494c618a4cb5f8eba
      size: 460145129
    outs:
    - path: cluster-hashes.parquet
      hash: md5
      md5: 1fb669f6f922fb2c35d2f3a5bd440669
      size: 516535247
  debug-graph:
    cmd: python ./run.py --rust extract-graph --cluster 100004141 -o book-links/debug-graph.gml
    deps:
    - path: book-links/book-graph.mp.zst
      md5: cbb067efc568960af703f83f5b73e9ac
      size: 1283174149
    - path: src/bin/extract-graph.rs
      md5: c22a75eb91d779306a11d8bd2065b3e6
      size: 1142
    outs:
    - path: book-links/debug-graph.gml
      md5: b2fb3c4a07ace6f85a1b880b54ab5da8
      size: 2144356
  schema@cluster-stats:
    cmd: python ../run.py --rust pq-info -o cluster-stats.json cluster-stats.parquet
    deps:
    - path: cluster-stats.parquet
      md5: a150ac1de5a09aa134485ca4f51dc239
      size: 141044160
    outs:
    - path: cluster-stats.json
      md5: a533037fe032a61424b5a63a0f7fcc05
      size: 816
  schema@cluster-first-authors:
    cmd: python ../run.py --rust pq-info -o cluster-first-authors.json cluster-first-authors.parquet
    deps:
    - path: cluster-first-authors.parquet
      md5: 71eb6ee9c09ea07e81d30bfe0852ae62
      size: 311491781
    outs:
    - path: cluster-first-authors.json
      md5: 5534f63f6f2c20f772a4c3943c9fb68c
      size: 254
  schema@cluster-genders:
    cmd: python ../run.py --rust pq-info -o cluster-genders.json cluster-genders.parquet
    deps:
    - path: cluster-genders.parquet
      md5: 63f769c2ab90b6eeca4511eef74aa17f
      size: 128381977
    outs:
    - path: cluster-genders.json
      md5: efd21c3df58cf4a481436f684a2481ea
      size: 249
  schema@all-isbns:
    cmd: python ../run.py --rust pq-info -o all-isbns.json all-isbns.parquet
    deps:
    - path: all-isbns.parquet
      md5: 4ee11717e5f2c80281d9d43cf8c8a0ce
      size: 268553025
    outs:
    - path: all-isbns.json
      md5: 2c8c9a7638942210e76e166498686c47
      size: 762
  schema@cluster-hashes:
    cmd: python ../run.py --rust pq-info -o cluster-hashes.json cluster-hashes.parquet
    deps:
    - path: cluster-hashes.parquet
      md5: 4d3fbcb580e960e8755c99d7ade44cbc
      size: 393915650
    outs:
    - path: cluster-hashes.json
      md5: 0eacbcdd2c62ea1e74f07c60f3142e6c
      size: 344
  schema@isbn-clusters:
    cmd: python ../run.py --rust pq-info -o isbn-clusters.json isbn-clusters.parquet
    deps:
    - path: isbn-clusters.parquet
      md5: 0d0a9af2c4c2693265430e538416c7ec
      size: 330611338
    outs:
    - path: isbn-clusters.json
      md5: bbf1815e3cbeba7fde817f2dd770e320
      size: 336
