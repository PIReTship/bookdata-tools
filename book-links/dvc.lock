schema: '2.0'
stages:
  collect-isbns:
    cmd: python run.py collect-isbns
    deps:
    - path: az2014/ratings.parquet
      md5: 89d86c911899e74369ac742ed2a63107
      size: 139023869
    - path: bx/cleaned-ratings.csv
      md5: da3196d4af84ae39b3713e73c59677c7
      size: 22627884
    - path: goodreads/gr-book-ids.parquet
      md5: 642f814bfe37f8dda7d5c258fe41f247
      size: 41353690
    - path: loc-mds/book-isbns.parquet
      md5: 5a906a01d5cc957c52a95bfa2e3587dd
      size: 61306604
    - path: openlibrary/edition-isbns.parquet
      md5: cb17120e48b9787ed7be87f22fb250c8
      size: 163872537
    - path: scripts/collect-isbns.py
      md5: f8e72d3172510e93d538966002609e2a
      size: 2166
    outs:
    - path: book-links/all-isbns.parquet
      md5: 10af4e0a7f7c5a000257c00bc0a05c33
      size: 151844823
  cluster:
    cmd: python run.py --rust cluster-books
    deps:
    - path: book-links/all-isbns.parquet
      md5: 10af4e0a7f7c5a000257c00bc0a05c33
      size: 151844823
    - path: goodreads/book-isbn-ids.parquet
      md5: f7ed46c05559e67e910714b6905f2d7c
      size: 33804964
    - path: goodreads/gr-book-ids.parquet
      md5: 642f814bfe37f8dda7d5c258fe41f247
      size: 41353690
    - path: loc-mds/book-ids.parquet
      md5: 0ecabde21c8cdcf31093ff10e6cc3dfb
      size: 73155576
    - path: loc-mds/book-isbn-ids.parquet
      md5: c75a0c9d1a633e6a96d710b139286a53
      size: 70571900
    - path: openlibrary/all-works.parquet
      md5: 5b9ee7b6fc4af8469a9d38f2b53b7335
      size: 160433515
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 8dcb8406a2bda68f1eb5468446012665
      size: 214094411
    - path: openlibrary/edition-works.parquet
      md5: 5d70449a2c8c89dc050e2e6327855d28
      size: 175549574
    - path: openlibrary/editions.parquet
      md5: f96cd8279796a4ab0918b293a6affa71
      size: 148811683
    - path: src/bin/cluster-books.rs
      md5: d02b6ee3e993c9797deda1dd7767700a
      size: 2032
    outs:
    - path: book-links/book-graph.mp.zst
      md5: aae2f97d01e56e5f76054679a184858b
      size: 546289597
    - path: book-links/cluster-codes.parquet
      md5: 926bd748779505e001b75e8bafe6524b
      size: 547079825
    - path: book-links/cluster-stats.parquet
      md5: 42467c84fa1656bf56c653f19350f4c0
      size: 113794505
    - path: book-links/isbn-clusters.parquet
      md5: a933bed219822c9ad50467b20de48ed7
      size: 258497042
  cluster-ol-first-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-ol-first-authors.parquet
      --first-author -s openlib
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: c1b27a37130afa2a02000db6a6f72560
      size: 161947431
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: d32ee6761ce02761550716be04aff6ff
      size: 5058
    outs:
    - path: book-links/cluster-ol-first-authors.parquet
      md5: 904074c232f3b92b06d292a0bf5a59ba
      size: 157503615
  cluster-loc-first-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-loc-first-authors.parquet
      --first-author -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: c1b27a37130afa2a02000db6a6f72560
      size: 161947431
    - path: loc-mds/book-authors.parquet
      md5: 84e80cec0e0df87404a44a03d8d60bf3
      size: 127163262
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: src/bin/cluster-authors.rs
      md5: d32ee6761ce02761550716be04aff6ff
      size: 5058
    outs:
    - path: book-links/cluster-loc-first-authors.parquet
      md5: 7866d20f22fffacbe0775d4ca2e28dba
      size: 58848984
  cluster-irst-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5ee9bb4b67de722e24363e140ea2791f
      size: 161946382
    - path: loc-mds/book-authors.parquet
      md5: 2d3212dbf2405c48fb8bf2587a8587c3
      size: 127567010
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: 76f614625858e7ad84e273e875861490
      size: 5253
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a7f439659cccd809efe4ac2ea276b058
      size: 157637977
  cluster-first-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: a933bed219822c9ad50467b20de48ed7
      size: 258497042
    - path: loc-mds/book-authors.parquet
      md5: 53994fff1611fe0429b81883e0439b0e
      size: 125793481
    - path: loc-mds/book-isbn-ids.parquet
      md5: c75a0c9d1a633e6a96d710b139286a53
      size: 70571900
    - path: openlibrary/author-names.parquet
      md5: c898edae916f07fe90fce8c6e2e7c2b0
      size: 141892030
    - path: openlibrary/edition-authors.parquet
      md5: f4ecbe271442d4834b06c5cc0f2b5feb
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 8dcb8406a2bda68f1eb5468446012665
      size: 214094411
    - path: src/bin/cluster-authors.rs
      md5: d8bb6ef8de585d8cd2deb2b6dbd17bb0
      size: 5038
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: 7c1931969ee2fe487a2cf101947c4f89
      size: 193429284
  cluster-genders:
    cmd: python run.py --rust cluster-author-gender -o book-links/cluster-genders.parquet
      -A book-links/cluster-first-authors.parquet
    deps:
    - path: book-links/cluster-first-authors.parquet
      md5: 7c1931969ee2fe487a2cf101947c4f89
      size: 193429284
    - path: book-links/cluster-stats.parquet
      md5: 42467c84fa1656bf56c653f19350f4c0
      size: 113794505
    - path: src/bin/cluster-author-gender/
      md5: a04a15876bc2eb5ff97448bb73f9792f.dir
      size: 7452
      nfiles: 3
    - path: viaf/author-genders.parquet
      md5: a7e3c869f8b444b8b0705d2e9bbf6dc2
      size: 148369290
    - path: viaf/author-name-index.parquet
      md5: 45307e4dad9dc4d9b4353d79c04f3195
      size: 521027574
    outs:
    - path: book-links/cluster-genders.parquet
      md5: 970c21e7f4726dedfc3bac33408d790c
      size: 110586637
  gender-stats:
    cmd: python ../run.py --rust fusion integration-stats.tcl
    deps:
    - path: ../az2014/az-cluster-ratings.parquet
      md5: 440075aa16046e8ec2beebfb6c366e60
      size: 203512785
    - path: ../bx/bx-cluster-actions.parquet
      md5: 3a2dd02a3a565a69755ce69df1f78f40
      size: 3377919
    - path: ../bx/bx-cluster-ratings.parquet
      md5: 3786efa5a188bea57b5e324c65e38cae
      size: 1657342
    - path: ../goodreads/gr-cluster-actions.parquet
      md5: c3f2ca81dc530591ef172bacca7b0a51
      size: 815072618
    - path: ../goodreads/gr-cluster-ratings.parquet
      md5: 8964b416e6797c43b050a54432a522a3
      size: 323836602
    - path: ../loc-mds/book-isbn-ids.parquet
      md5: c75a0c9d1a633e6a96d710b139286a53
      size: 70571900
    - path: cluster-genders.parquet
      md5: 970c21e7f4726dedfc3bac33408d790c
      size: 110586637
    - path: integration-stats.tcl
      md5: 8e1047cc209458a45d73986002a43e01
      size: 1794
    - path: isbn-clusters.parquet
      md5: a933bed219822c9ad50467b20de48ed7
      size: 258497042
    outs:
    - path: gender-stats.csv
      md5: 63d618b867d547f47ec1fe9c05d8e239
      size: 1102
  cluster-hashes:
    cmd: python cluster-hash.py
    deps:
    - path: cluster-hash.py
      md5: 63af95d34bf99ca5feb58cce4a7715ee
      size: 762
    - path: isbn-clusters.parquet
      md5: 7641cf2bf32b14fdf57f08be8df9d23b
      size: 260471224
    outs:
    - path: cluster-hashes.parquet
      md5: a6d79fc94d5e066a6b14ceecaea29fd9
      size: 239512394
