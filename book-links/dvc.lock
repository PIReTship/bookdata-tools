schema: '2.0'
stages:
  collect-isbns:
    cmd: python ../run.py --rust collect-isbns -o all-isbns.parquet all-isbns.toml
    deps:
    - path: ../az2014/ratings.parquet
      md5: 837bfe4ded39ed9e5e5758e9fbb8c7ae
      size: 147930125
    - path: ../bx/cleaned-ratings.csv
      md5: da3196d4af84ae39b3713e73c59677c7
      size: 22627884
    - path: ../goodreads/gr-book-ids.parquet
      md5: 40d3f3a5914f546c0f71cadf696e8072
      size: 36138262
    - path: ../loc-mds/book-isbns.parquet
      md5: b6b4ebf2da3a565891160c3ab4bfcbc4
      size: 54259877
    - path: ../openlibrary/edition-isbns.parquet
      md5: 0e76c64885ccfb83ad440fedaec3346e
      size: 199068182
    - path: ../src/cli/collect_isbns.rs
      md5: 63d2b42b855b9aa5c5c153d4c3f0e739
      size: 3027
    - path: all-isbns.toml
      md5: 8d1990ca34a435e464021afb3b5fc9ed
      size: 423
    outs:
    - path: all-isbns.parquet
      md5: 52780f86f07cc24d498b2c1375eea2cb
      size: 253096851
  cluster:
    cmd: python run.py --rust cluster-books
    deps:
    - path: book-links/all-isbns.parquet
      md5: 52780f86f07cc24d498b2c1375eea2cb
      size: 253096851
    - path: goodreads/book-isbn-ids.parquet
      md5: 24726586d4f49562e5b9550a9b9a7b11
      size: 19489858
    - path: goodreads/gr-book-ids.parquet
      md5: 40d3f3a5914f546c0f71cadf696e8072
      size: 36138262
    - path: loc-mds/book-ids.parquet
      md5: 3707a4a3955cb1a55f3c1acd68fc7454
      size: 64554968
    - path: loc-mds/book-isbn-ids.parquet
      md5: 8438185b9d82907cb4397b1348bc3843
      size: 42805700
    - path: openlibrary/all-works.parquet
      md5: cb6afd7c9c556a8b9d8f9d7dcf359195
      size: 199518887
    - path: openlibrary/edition-isbn-ids.parquet
      md5: c4abff634f17dc517e4a33ba1965c05f
      size: 197128365
    - path: openlibrary/edition-works.parquet
      md5: 42b4e843a62bcdf25b43500d76a51d63
      size: 203829867
    - path: openlibrary/editions.parquet
      md5: 2dfe44c47096a8eaa68b8f1c0dc3c855
      size: 980200582
    - path: src/cli/cluster_books.rs
      md5: a7be7a18af7ac92557becf4c84fae075
      size: 4615
    - path: src/graph/
      md5: 3ca1a71be3d3b3ce0d9fde9cfabcceda.dir
      size: 10430
      nfiles: 4
    outs:
    - path: book-links/book-graph.mp.zst
      md5: 22906f958dd019986ffc8bf6392e3ee1
      size: 1375793968
    - path: book-links/cluster-graph-edges.parquet
      md5: 0d396f2ba740a6efb17e474fd09992ca
      size: 481455844
    - path: book-links/cluster-graph-nodes.parquet
      md5: f1711ddc9f0e6a882c07a9726fd06d08
      size: 798226433
    - path: book-links/cluster-metrics.json
      md5: 9ffde9c644652e8e3fc87fcdb378e011
      size: 37
    - path: book-links/cluster-stats.parquet
      md5: 1c4b66635a12bd3670dda7658cad3175
      size: 139715395
    - path: book-links/isbn-clusters.parquet
      md5: b3cc41cb081f3a8cee95148c747c2f8f
      size: 311564451
  cluster-ol-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-ol-first-authors.parquet
      --first-author -s openlib
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: e28def686bb5d0dd07170f3cc3101144
      size: 313169676
    - path: openlibrary/author-names.parquet
      md5: bf6b7ed566d875c1659453bf663211d4
      size: 166418847
    - path: openlibrary/edition-authors.parquet
      md5: 50c1e7b2546c4f84b6e3d46892cf9cbb
      size: 195230721
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 8745d981c292e41f88375b1464a52588
      size: 198069548
    - path: src/cli/cluster
      md5: 9ea39ff3e449739c3257f2dec430b43f.dir
      size: 25068
      nfiles: 11
    outs:
    - path: book-links/cluster-ol-first-authors.parquet
      md5: 97e0ea3f755674d0b6396c8a6571083d
      size: 222300574
  cluster-loc-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-loc-first-authors.parquet
      --first-author -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: e28def686bb5d0dd07170f3cc3101144
      size: 313169676
    - path: loc-mds/book-authors.parquet
      md5: 19829781bb046808ce772eed115e55fb
      size: 102117852
    - path: loc-mds/book-isbn-ids.parquet
      md5: e93ebcecc54af329a3be1146e56895aa
      size: 47921043
    - path: src/cli/cluster
      md5: 9ea39ff3e449739c3257f2dec430b43f.dir
      size: 25068
      nfiles: 11
    outs:
    - path: book-links/cluster-loc-first-authors.parquet
      md5: 850c5aaf7d58a8d90836bda19b15b146
      size: 56262822
  cluster-irst-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5ee9bb4b67de722e24363e140ea2791f
      size: 161946382
    - path: loc-mds/book-authors.parquet
      md5: 2d3212dbf2405c48fb8bf2587a8587c3
      size: 127567010
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: 76f614625858e7ad84e273e875861490
      size: 5253
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a7f439659cccd809efe4ac2ea276b058
      size: 157637977
  cluster-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: b3cc41cb081f3a8cee95148c747c2f8f
      size: 311564451
    - path: loc-mds/book-authors.parquet
      md5: c46c8998dfdfd25b91c88b225a436466
      size: 100853758
    - path: loc-mds/book-isbn-ids.parquet
      md5: 8438185b9d82907cb4397b1348bc3843
      size: 42805700
    - path: openlibrary/author-names.parquet
      md5: 289bf26896ced89e06e6afd84bea88be
      size: 163983500
    - path: openlibrary/edition-authors.parquet
      md5: b510eec2ad6e88005821418e9ebc88ae
      size: 195230722
    - path: openlibrary/edition-isbn-ids.parquet
      md5: c4abff634f17dc517e4a33ba1965c05f
      size: 197128365
    - path: src/cli/cluster
      md5: 9ea39ff3e449739c3257f2dec430b43f.dir
      size: 25968
      nfiles: 11
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: c92b2d76bb840b0275f5ccde2b4a202b
      size: 245339454
  cluster-genders:
    cmd: python run.py --rust cluster extract-author-gender -o book-links/cluster-genders.parquet
      -A book-links/cluster-first-authors.parquet
    deps:
    - path: book-links/cluster-first-authors.parquet
      md5: c92b2d76bb840b0275f5ccde2b4a202b
      size: 245339454
    - path: book-links/cluster-stats.parquet
      md5: 1c4b66635a12bd3670dda7658cad3175
      size: 139715395
    - path: src/cli/cluster
      md5: 9ea39ff3e449739c3257f2dec430b43f.dir
      size: 25968
      nfiles: 11
    - path: viaf/author-genders.parquet
      md5: 6f2e84ec0ae6bb81d54e369dda7a91bd
      size: 120612452
    - path: viaf/author-name-index.parquet
      md5: 243e3b5324dc7e06c05a30449cf244fe
      size: 543716933
    outs:
    - path: book-links/cluster-genders.parquet
      md5: f2a2eb18630ef064e9ab6617a754642a
      size: 126807047
  gender-stats:
    cmd: python ../run.py --rust fusion integration-stats.tcl
    deps:
    - path: ../az2014/az-cluster-ratings.parquet
      md5: af42ca3ce192f56da707eafbb96b85d3
      size: 302492129
    - path: ../bx/bx-cluster-actions.parquet
      md5: f0ebbaff7ba2f431c76dc0af96ce7eed
      size: 7293747
    - path: ../bx/bx-cluster-ratings.parquet
      md5: 6093f665c51e081f2dd6ef129b5c493f
      size: 3059329
    - path: ../goodreads/gr-cluster-actions.parquet
      md5: e657f268e6ac47bdf4299fdd1bb14362
      size: 2892060069
    - path: ../goodreads/gr-cluster-ratings.parquet
      md5: 4b00812fa40ce32896439d05b846a11c
      size: 1385738270
    - path: ../loc-mds/book-isbn-ids.parquet
      md5: 8438185b9d82907cb4397b1348bc3843
      size: 42805700
    - path: cluster-genders.parquet
      md5: f2a2eb18630ef064e9ab6617a754642a
      size: 126807047
    - path: integration-stats.tcl
      md5: 0b47c45c920d62c0c476e1eca3b312a5
      size: 2019
    - path: isbn-clusters.parquet
      md5: b3cc41cb081f3a8cee95148c747c2f8f
      size: 311564451
    outs:
    - path: gender-stats.csv
      md5: ce2bf416de94e468b05966c16f7a5c94
      size: 1152
  cluster-hashes:
    cmd: python ../run.py --rust cluster hash -o cluster-hashes.parquet
    deps:
    - path: ../src/cli/cluster
      md5: 9ea39ff3e449739c3257f2dec430b43f.dir
      size: 25068
      nfiles: 11
    - path: isbn-clusters.parquet
      md5: e28def686bb5d0dd07170f3cc3101144
      size: 313169676
    outs:
    - path: cluster-hashes.parquet
      md5: 86f7409ade3e1fa2cc5aeb967dbc7ce2
      size: 349222782
  debug-graph:
    cmd: python ./run.py --rust extract-graph --cluster 100004141 -o book-links/debug-graph.gml
    deps:
    - path: book-links/book-graph.mp.zst
      md5: cbb067efc568960af703f83f5b73e9ac
      size: 1283174149
    - path: src/bin/extract-graph.rs
      md5: c22a75eb91d779306a11d8bd2065b3e6
      size: 1142
    outs:
    - path: book-links/debug-graph.gml
      md5: b2fb3c4a07ace6f85a1b880b54ab5da8
      size: 2144356
  schema@cluster-stats:
    cmd: python ../run.py --rust pq-info -o cluster-stats.json cluster-stats.parquet
    deps:
    - path: cluster-stats.parquet
      md5: a409e62750d2ba2ac91f2f39411927e9
      size: 144347413
    outs:
    - path: cluster-stats.json
      md5: 09f7f423f4a820367058f9ed5fd2964c
      size: 1232
  schema@cluster-first-authors:
    cmd: python ../run.py --rust pq-info -o cluster-first-authors.json cluster-first-authors.parquet
    deps:
    - path: cluster-first-authors.parquet
      md5: 0941e75a590a02f15703bb4a2f219ba3
      size: 251869803
    outs:
    - path: cluster-first-authors.json
      md5: ff2345292827888d0a7bf03f3da2c79a
      size: 358
  schema@cluster-genders:
    cmd: python ../run.py --rust pq-info -o cluster-genders.json cluster-genders.parquet
    deps:
    - path: cluster-genders.parquet
      md5: aea3cf2c0815a9b16114d21b64fb1a35
      size: 127882923
    outs:
    - path: cluster-genders.json
      md5: aa819dda34a3a414f1bcf35166b53e6c
      size: 353
  schema@all-isbns:
    cmd: python ../run.py --rust pq-info -o all-isbns.json all-isbns.parquet
    deps:
    - path: all-isbns.parquet
      md5: e2df5fb6396729ea6c1e52140610ee46
      size: 257503194
    outs:
    - path: all-isbns.json
      md5: 35d3e305fadfb63eb13d0cd118344187
      size: 1039
  schema@cluster-hashes:
    cmd: python ../run.py --rust pq-info -o cluster-hashes.json cluster-hashes.parquet
    deps:
    - path: cluster-hashes.parquet
      md5: 86f7409ade3e1fa2cc5aeb967dbc7ce2
      size: 349222782
    outs:
    - path: cluster-hashes.json
      md5: 6b9dee3667ef1b4dd474e815b00093c8
      size: 500
  schema@isbn-clusters:
    cmd: python ../run.py --rust pq-info -o isbn-clusters.json isbn-clusters.parquet
    deps:
    - path: isbn-clusters.parquet
      md5: e28def686bb5d0dd07170f3cc3101144
      size: 313169676
    outs:
    - path: isbn-clusters.json
      md5: ff5838a2e8cc8cc473725c78efe383b8
      size: 492
