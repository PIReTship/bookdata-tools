schema: '2.0'
stages:
  collect-isbns:
    cmd: python ../run.py --rust collect-isbns -o all-isbns.parquet all-isbns.toml
    deps:
    - path: ../az2014/ratings.parquet
      md5: ce4e92caf57025df11703cb5144c7630
      size: 137819157
    - path: ../az2018/ratings.parquet
      md5: 060809287f39a08c63724a1e8ae0fd8d
      size: 316701214
    - path: ../bx/cleaned-ratings.csv
      md5: e2c423d665fb5271def51d358c8c285c
      size: 22627335
    - path: ../goodreads/gr-book-ids.parquet
      md5: e259dab35fc7e37e8904bc2584245138
      size: 37497686
    - path: ../loc-mds/book-isbns.parquet
      md5: ca03e6c54a490743746f2bc2a73ad3f0
      size: 55680857
    - path: ../openlibrary/edition-isbns.parquet
      md5: 4e25efdddefdaa656de713a99b0ca2d7
      size: 207849845
    - path: ../src/cli/collect_isbns.rs
      md5: d35a68fb31e0ef493e26ac749d1d7a75
      size: 2705
    - path: all-isbns.toml
      md5: 58da443b1ccfdd3def283c05408179d8
      size: 458
    outs:
    - path: all-isbns.parquet
      md5: 4ee11717e5f2c80281d9d43cf8c8a0ce
      size: 268553025
  cluster:
    cmd: python run.py --rust cluster-books --save-graph book-links/book-graph.mp.zst
    deps:
    - path: book-links/all-isbns.parquet
      md5: 4ee11717e5f2c80281d9d43cf8c8a0ce
      size: 268553025
    - path: goodreads/book-isbn-ids.parquet
      md5: 100ea102d2775993cc40522df7210687
      size: 15490623
    - path: goodreads/gr-book-ids.parquet
      md5: e259dab35fc7e37e8904bc2584245138
      size: 37497686
    - path: loc-mds/book-ids.parquet
      md5: b8e4eb3ee0b6330bcd655a64b1fa89e6
      size: 65210771
    - path: loc-mds/book-isbn-ids.parquet
      md5: 1022f7b00a26899573dd319637cb098e
      size: 34297513
    - path: openlibrary/all-works.parquet
      md5: 832cc1253307df9c7bbe4d83e7e3fa93
      size: 176243794
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 6cf6500ebab273315fa90e2f2031dd3b
      size: 145485299
    - path: openlibrary/edition-works.parquet
      md5: 9e7de4af3d400505f77235d8f903f826
      size: 203839441
    - path: openlibrary/editions.parquet
      md5: b082da165d2b2d9c0fa5489376c8c57a
      size: 888704794
    - path: src/cli/cluster_books.rs
      md5: 15b1ce5ef574f3aaa74125402f278f77
      size: 5703
    - path: src/graph/
      md5: eacade457b1b7f9b6312c2408ba6ec99.dir
      size: 10288
      nfiles: 4
    outs:
    - path: book-links/book-graph.mp.zst
      md5: d165edc97e5290688ca38b4e44b4a40e
      size: 1241849711
    - path: book-links/cluster-graph-edges.parquet
      md5: 629bdac5395778396d1c91d57f6b5110
      size: 418022703
    - path: book-links/cluster-graph-nodes.parquet
      md5: b3ab34c04781686ced3aeca4f06baaa8
      size: 823859793
    - path: book-links/cluster-metrics.json
      md5: 905e5056cef17bb04890e71c546bd345
      size: 37
    - path: book-links/cluster-stats.parquet
      md5: a150ac1de5a09aa134485ca4f51dc239
      size: 141044160
    - path: book-links/isbn-clusters.parquet
      md5: 0d0a9af2c4c2693265430e538416c7ec
      size: 330611338
  cluster-ol-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-ol-first-authors.parquet
      --first-author -s openlib
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 0d0a9af2c4c2693265430e538416c7ec
      size: 330611338
    - path: openlibrary/author-names.parquet
      md5: 76ca0c2e90393598cc71578ffe5493d1
      size: 151081619
    - path: openlibrary/edition-authors.parquet
      md5: 231cda3e2643ce16e46942a58aa3b57e
      size: 193584177
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 6cf6500ebab273315fa90e2f2031dd3b
      size: 145485299
    - path: src/cli/cluster
      md5: 31f93585710e4e47ab1c95acbf05bdb6.dir
      size: 19168
      nfiles: 7
    outs:
    - path: book-links/cluster-ol-first-authors.parquet
      md5: 4466e5eb35d5428b2140c72304bea885
      size: 254671736
  cluster-loc-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-loc-first-authors.parquet
      --first-author -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 0d0a9af2c4c2693265430e538416c7ec
      size: 330611338
    - path: loc-mds/book-authors.parquet
      md5: 415b0a79bb7bc1c7c6651eaccf0d9d30
      size: 85290815
    - path: loc-mds/book-isbn-ids.parquet
      md5: 1022f7b00a26899573dd319637cb098e
      size: 34297513
    - path: src/cli/cluster
      md5: 31f93585710e4e47ab1c95acbf05bdb6.dir
      size: 19168
      nfiles: 7
    outs:
    - path: book-links/cluster-loc-first-authors.parquet
      md5: 51194420ec47665e85bf98e9ecfcb1c1
      size: 52449894
  cluster-irst-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5ee9bb4b67de722e24363e140ea2791f
      size: 161946382
    - path: loc-mds/book-authors.parquet
      md5: 2d3212dbf2405c48fb8bf2587a8587c3
      size: 127567010
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: 76f614625858e7ad84e273e875861490
      size: 5253
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a7f439659cccd809efe4ac2ea276b058
      size: 157637977
  cluster-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 0d0a9af2c4c2693265430e538416c7ec
      size: 330611338
    - path: loc-mds/book-authors.parquet
      md5: 415b0a79bb7bc1c7c6651eaccf0d9d30
      size: 85290815
    - path: loc-mds/book-isbn-ids.parquet
      md5: 1022f7b00a26899573dd319637cb098e
      size: 34297513
    - path: openlibrary/author-names.parquet
      md5: 76ca0c2e90393598cc71578ffe5493d1
      size: 151081619
    - path: openlibrary/edition-authors.parquet
      md5: 231cda3e2643ce16e46942a58aa3b57e
      size: 193584177
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 6cf6500ebab273315fa90e2f2031dd3b
      size: 145485299
    - path: src/cli/cluster
      md5: 31f93585710e4e47ab1c95acbf05bdb6.dir
      size: 19168
      nfiles: 7
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: 71eb6ee9c09ea07e81d30bfe0852ae62
      size: 311491781
  cluster-genders:
    cmd: python run.py --rust cluster extract-author-gender -o book-links/cluster-genders.parquet
      -A book-links/cluster-first-authors.parquet
    deps:
    - path: book-links/cluster-first-authors.parquet
      md5: 71eb6ee9c09ea07e81d30bfe0852ae62
      size: 311491781
    - path: book-links/cluster-stats.parquet
      md5: a150ac1de5a09aa134485ca4f51dc239
      size: 141044160
    - path: src/cli/cluster
      md5: 31f93585710e4e47ab1c95acbf05bdb6.dir
      size: 19168
      nfiles: 7
    - path: viaf/author-genders.parquet
      md5: 505a5a8f30082f297cb79995435a82c3
      size: 115121052
    - path: viaf/author-name-index.parquet
      md5: 28bdb3cdaf4f193087e566662a880b22
      size: 515538267
    outs:
    - path: book-links/cluster-genders.parquet
      md5: 63f769c2ab90b6eeca4511eef74aa17f
      size: 128381977
  gender-stats:
    cmd: python run.py --rust integration-stats
    deps:
    - path: az2014/az-cluster-ratings.parquet
      md5: bcb0ee6021c331bcd76376c70850ceef
      size: 289575451
    - path: az2018/az-cluster-ratings.parquet
      md5: c9ecf365a84cfb2ff36b87ec9c393c35
      size: 661901612
    - path: book-links/cluster-genders.parquet
      md5: 63f769c2ab90b6eeca4511eef74aa17f
      size: 128381977
    - path: book-links/isbn-clusters.parquet
      md5: 0d0a9af2c4c2693265430e538416c7ec
      size: 330611338
    - path: bx/bx-cluster-actions.parquet
      md5: 1df15b817c96b05f884e6676a1ea3352
      size: 7128926
    - path: bx/bx-cluster-ratings.parquet
      md5: 4da8e35f1f38bae7e97fa8ea10d97d3f
      size: 3004685
    - path: config.toml
      md5: 503d4b6f908c108d776794835d99d0a5
      size: 87
    - path: goodreads/simple/gr-cluster-actions.parquet
      md5: 5754902ca2ec1049f606657965549b7d
      size: 1405175187
    - path: goodreads/simple/gr-cluster-ratings.parquet
      md5: 3c8b17fab0b17767407cde13e65ad4fb
      size: 659768795
    - path: loc-mds/book-isbn-ids.parquet
      md5: 1022f7b00a26899573dd319637cb098e
      size: 34297513
    - path: src/cli/stats.rs
      md5: 94660a494c8bf23fc68879d1520902e9
      size: 3384
    outs:
    - path: book-links/gender-stats.csv
      md5: 4b8ca0e54a85c4f33047168211d4d4b8
      size: 1337
  cluster-hashes:
    cmd: python ../run.py --rust cluster hash -o cluster-hashes.parquet isbn-clusters.parquet
    deps:
    - path: ../src/cli/cluster/hash.rs
      md5: ef2834f7770f076609cb7537cce9b58d
      size: 2526
    - path: isbn-clusters.parquet
      md5: 0d0a9af2c4c2693265430e538416c7ec
      size: 330611338
    outs:
    - path: cluster-hashes.parquet
      md5: 4d3fbcb580e960e8755c99d7ade44cbc
      size: 393915650
  debug-graph:
    cmd: python ./run.py --rust extract-graph --cluster 100004141 -o book-links/debug-graph.gml
    deps:
    - path: book-links/book-graph.mp.zst
      md5: cbb067efc568960af703f83f5b73e9ac
      size: 1283174149
    - path: src/bin/extract-graph.rs
      md5: c22a75eb91d779306a11d8bd2065b3e6
      size: 1142
    outs:
    - path: book-links/debug-graph.gml
      md5: b2fb3c4a07ace6f85a1b880b54ab5da8
      size: 2144356
  schema@cluster-stats:
    cmd: python ../run.py --rust pq-info -o cluster-stats.json cluster-stats.parquet
    deps:
    - path: cluster-stats.parquet
      md5: a150ac1de5a09aa134485ca4f51dc239
      size: 141044160
    outs:
    - path: cluster-stats.json
      md5: a533037fe032a61424b5a63a0f7fcc05
      size: 816
  schema@cluster-first-authors:
    cmd: python ../run.py --rust pq-info -o cluster-first-authors.json cluster-first-authors.parquet
    deps:
    - path: cluster-first-authors.parquet
      md5: 71eb6ee9c09ea07e81d30bfe0852ae62
      size: 311491781
    outs:
    - path: cluster-first-authors.json
      md5: 5534f63f6f2c20f772a4c3943c9fb68c
      size: 254
  schema@cluster-genders:
    cmd: python ../run.py --rust pq-info -o cluster-genders.json cluster-genders.parquet
    deps:
    - path: cluster-genders.parquet
      md5: 63f769c2ab90b6eeca4511eef74aa17f
      size: 128381977
    outs:
    - path: cluster-genders.json
      md5: efd21c3df58cf4a481436f684a2481ea
      size: 249
  schema@all-isbns:
    cmd: python ../run.py --rust pq-info -o all-isbns.json all-isbns.parquet
    deps:
    - path: all-isbns.parquet
      md5: 4ee11717e5f2c80281d9d43cf8c8a0ce
      size: 268553025
    outs:
    - path: all-isbns.json
      md5: 2c8c9a7638942210e76e166498686c47
      size: 762
  schema@cluster-hashes:
    cmd: python ../run.py --rust pq-info -o cluster-hashes.json cluster-hashes.parquet
    deps:
    - path: cluster-hashes.parquet
      md5: 4d3fbcb580e960e8755c99d7ade44cbc
      size: 393915650
    outs:
    - path: cluster-hashes.json
      md5: 0eacbcdd2c62ea1e74f07c60f3142e6c
      size: 344
  schema@isbn-clusters:
    cmd: python ../run.py --rust pq-info -o isbn-clusters.json isbn-clusters.parquet
    deps:
    - path: isbn-clusters.parquet
      md5: 0d0a9af2c4c2693265430e538416c7ec
      size: 330611338
    outs:
    - path: isbn-clusters.json
      md5: bbf1815e3cbeba7fde817f2dd770e320
      size: 336
