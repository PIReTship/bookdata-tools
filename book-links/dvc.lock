schema: '2.0'
stages:
  collect-isbns:
    cmd: python ../run.py --rust collect-isbns -o all-isbns.parquet all-isbns.toml
    deps:
    - path: ../az2014/ratings.parquet
      md5: 16442bc70b86c53dc8e5941ac85e7a18
      size: 136992321
    - path: ../bx/cleaned-ratings.csv
      md5: e2c423d665fb5271def51d358c8c285c
      size: 22627335
    - path: ../goodreads/gr-book-ids.parquet
      md5: b29c1441c2377d98a803c0cc38b0bc33
      size: 37758445
    - path: ../loc-mds/book-isbns.parquet
      md5: 5668ed57ca631961b5b351f09311e5a5
      size: 56228810
    - path: ../openlibrary/edition-isbns.parquet
      md5: 5e0dae8e61920a6e60251bc3e0a0f03b
      size: 211653101
    - path: ../src/cli/collect_isbns.rs
      md5: fa71e24fecec60200afb0e9c2066629e
      size: 2644
    - path: all-isbns.toml
      md5: 8d1990ca34a435e464021afb3b5fc9ed
      size: 423
    outs:
    - path: all-isbns.parquet
      md5: 9302a3aead9731d0546870906d363ee1
      size: 264915270
  cluster:
    cmd: python run.py --rust cluster-books --save-graph book-links/book-graph.mp.zst
    deps:
    - path: book-links/all-isbns.parquet
      md5: 9302a3aead9731d0546870906d363ee1
      size: 264915270
    - path: goodreads/book-isbn-ids.parquet
      md5: 2755a6024fb9dbe622cb71900d748f55
      size: 23507523
    - path: goodreads/gr-book-ids.parquet
      md5: b29c1441c2377d98a803c0cc38b0bc33
      size: 37758445
    - path: loc-mds/book-ids.parquet
      md5: 38346ca168b32be26216dba43e5a6ef4
      size: 66927842
    - path: loc-mds/book-isbn-ids.parquet
      md5: 0447d85bd94d366acdb8dcd23d2faf89
      size: 34468465
    - path: openlibrary/all-works.parquet
      md5: 1b9a3d75dd8a0e4c25176daf864d1ee2
      size: 181910106
    - path: openlibrary/edition-isbn-ids.parquet
      md5: a86e11f2a48128cefdf5578b99754111
      size: 223535401
    - path: openlibrary/edition-works.parquet
      md5: 53632b1fc28f4bc8f0775f5518ec865b
      size: 203821436
    - path: openlibrary/editions.parquet
      md5: bc080214dcb896f99624cb14d13c9706
      size: 887407054
    - path: src/cli/cluster_books.rs
      md5: 9edfd6314d703bda7231ffd9b6cd7741
      size: 5079
    - path: src/graph/
      md5: 5ce7189a6287c4543e5f8447802fdc80.dir
      size: 9793
      nfiles: 4
    outs:
    - path: book-links/book-graph.mp.zst
      md5: 8da0a5979de51730a9961824cb32296e
      size: 1366310019
    - path: book-links/cluster-graph-edges.parquet
      md5: 5d07b117b983458111e0151521f2f176
      size: 501710664
    - path: book-links/cluster-graph-nodes.parquet
      md5: 43d428bb42dcd28b93546c08a685d923
      size: 823727795
    - path: book-links/cluster-metrics.json
      md5: 012acd368e978bfc5fd639022d48cc1d
      size: 37
    - path: book-links/cluster-stats.parquet
      md5: ada8061e526b9c063fff1f39bb739b0b
      size: 137219663
    - path: book-links/isbn-clusters.parquet
      md5: eb38d5c8b4d1596d338a3e642f79c30e
      size: 326330170
  cluster-ol-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-ol-first-authors.parquet
      --first-author -s openlib
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 6c80d658cf126eecdae4fc5e963246a4
      size: 326819016
    - path: openlibrary/author-names.parquet
      md5: 1af0e26605c0f6b58b9c881d53633622
      size: 149833187
    - path: openlibrary/edition-authors.parquet
      md5: 887d3b1709b880338a9e93ecbeb213f6
      size: 193094588
    - path: openlibrary/edition-isbn-ids.parquet
      md5: ee12272dacee486d5303210463eb4531
      size: 226344292
    - path: src/cli/cluster
      md5: 9efd2786f8e60b77c27d03c49680ff33.dir
      size: 14863
      nfiles: 6
    outs:
    - path: book-links/cluster-ol-first-authors.parquet
      md5: 572577758c8877d138c78e694677f284
      size: 247926399
  cluster-loc-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-loc-first-authors.parquet
      --first-author -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 6c80d658cf126eecdae4fc5e963246a4
      size: 326819016
    - path: loc-mds/book-authors.parquet
      md5: 3585eceab422d960e403a2a146bb0b5f
      size: 84128212
    - path: loc-mds/book-isbn-ids.parquet
      md5: ae2224c35459575ae2c40d5b3b58948c
      size: 34468465
    - path: src/cli/cluster
      md5: 9efd2786f8e60b77c27d03c49680ff33.dir
      size: 14863
      nfiles: 6
    outs:
    - path: book-links/cluster-loc-first-authors.parquet
      md5: 38ab9fe9a5272862e926918d6a86ab22
      size: 51651437
  cluster-irst-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5ee9bb4b67de722e24363e140ea2791f
      size: 161946382
    - path: loc-mds/book-authors.parquet
      md5: 2d3212dbf2405c48fb8bf2587a8587c3
      size: 127567010
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: 76f614625858e7ad84e273e875861490
      size: 5253
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a7f439659cccd809efe4ac2ea276b058
      size: 157637977
  cluster-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 6c80d658cf126eecdae4fc5e963246a4
      size: 326819016
    - path: loc-mds/book-authors.parquet
      md5: 3585eceab422d960e403a2a146bb0b5f
      size: 84128212
    - path: loc-mds/book-isbn-ids.parquet
      md5: ae2224c35459575ae2c40d5b3b58948c
      size: 34468465
    - path: openlibrary/author-names.parquet
      md5: 1af0e26605c0f6b58b9c881d53633622
      size: 149833187
    - path: openlibrary/edition-authors.parquet
      md5: 887d3b1709b880338a9e93ecbeb213f6
      size: 193094588
    - path: openlibrary/edition-isbn-ids.parquet
      md5: ee12272dacee486d5303210463eb4531
      size: 226344292
    - path: src/cli/cluster
      md5: 9efd2786f8e60b77c27d03c49680ff33.dir
      size: 15363
      nfiles: 6
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: 7f5cba7dd028a27f6a8d1581dce773bd
      size: 304502896
  cluster-genders:
    cmd: python run.py --rust cluster extract-author-gender -o book-links/cluster-genders.parquet
      -A book-links/cluster-first-authors.parquet
    deps:
    - path: book-links/cluster-first-authors.parquet
      md5: 7f5cba7dd028a27f6a8d1581dce773bd
      size: 304502896
    - path: book-links/cluster-stats.parquet
      md5: e8d9dd436c123049952c548126c43203
      size: 138740105
    - path: src/cli/cluster
      md5: 9efd2786f8e60b77c27d03c49680ff33.dir
      size: 14863
      nfiles: 6
    - path: viaf/author-genders.parquet
      md5: b27e2090ebe7ce18ace8efafc1c1def8
      size: 115079572
    - path: viaf/author-name-index.parquet
      md5: 403bc43e24ebd020d9a652b69f79a11f
      size: 516463056
    outs:
    - path: book-links/cluster-genders.parquet
      md5: d13921bc13dc9d3afae13e038c0bc7b5
      size: 125332249
  gender-stats:
    cmd: python run.py --rust integration-stats
    deps:
    - path: az2014/az-cluster-ratings.parquet
      md5: 292ea2c8cd15ced17f815e0a6fae35c4
      size: 291897109
    - path: book-links/cluster-genders.parquet
      md5: d13921bc13dc9d3afae13e038c0bc7b5
      size: 125332249
    - path: book-links/isbn-clusters.parquet
      md5: eb38d5c8b4d1596d338a3e642f79c30e
      size: 326330170
    - path: bx/bx-cluster-actions.parquet
      md5: 7d94a0b3689ac2e5035d435b686b294c
      size: 7070832
    - path: bx/bx-cluster-ratings.parquet
      md5: 653ed7b4552f0a59a8c1a88203614eb5
      size: 2988371
    - path: config.toml
      md5: 503d4b6f908c108d776794835d99d0a5
      size: 90
    - path: goodreads/simple/gr-cluster-actions.parquet
      md5: 0baf9bdc60117c76f8e1c937a2da935d
      size: 1471898571
    - path: goodreads/simple/gr-cluster-ratings.parquet
      md5: 132bf93460e21ca29e0c4dedddcc9e42
      size: 690108784
    - path: loc-mds/book-isbn-ids.parquet
      md5: 2713a57bbe343e9029c4b5670b21828e
      size: 33782032
    - path: src/cli/stats.rs
      md5: b5ba22e45974a2751e884624dc9b554d
      size: 3136
    outs:
    - path: book-links/gender-stats.csv
      md5: abd4e1eaab0e70401e8b9ec4a934a8d2
      size: 1063
  cluster-hashes:
    cmd: python ../run.py --rust cluster hash -o cluster-hashes.parquet isbn-clusters.parquet
    deps:
    - path: ../src/cli/cluster/hash.rs
      md5: 3985bb6edb6040b1b19ec36b2815b4b2
      size: 2345
    - path: isbn-clusters.parquet
      md5: 6c80d658cf126eecdae4fc5e963246a4
      size: 326819016
    outs:
    - path: cluster-hashes.parquet
      md5: 4dbcb0d97ed994ef4fc074d2f9db5894
      size: 377124938
  debug-graph:
    cmd: python ./run.py --rust extract-graph --cluster 100004141 -o book-links/debug-graph.gml
    deps:
    - path: book-links/book-graph.mp.zst
      md5: cbb067efc568960af703f83f5b73e9ac
      size: 1283174149
    - path: src/bin/extract-graph.rs
      md5: c22a75eb91d779306a11d8bd2065b3e6
      size: 1142
    outs:
    - path: book-links/debug-graph.gml
      md5: b2fb3c4a07ace6f85a1b880b54ab5da8
      size: 2144356
  schema@cluster-stats:
    cmd: python ../run.py --rust pq-info -o cluster-stats.json cluster-stats.parquet
    deps:
    - path: cluster-stats.parquet
      md5: e8d9dd436c123049952c548126c43203
      size: 138740105
    outs:
    - path: cluster-stats.json
      md5: eab41cf3a56e6b244e7b3b5e9e88683c
      size: 816
  schema@cluster-first-authors:
    cmd: python ../run.py --rust pq-info -o cluster-first-authors.json cluster-first-authors.parquet
    deps:
    - path: cluster-first-authors.parquet
      md5: 7f5cba7dd028a27f6a8d1581dce773bd
      size: 304502896
    outs:
    - path: cluster-first-authors.json
      md5: 9d13b1c6f8c908c21f2fa37002962990
      size: 254
  schema@cluster-genders:
    cmd: python ../run.py --rust pq-info -o cluster-genders.json cluster-genders.parquet
    deps:
    - path: cluster-genders.parquet
      md5: d13921bc13dc9d3afae13e038c0bc7b5
      size: 125332249
    outs:
    - path: cluster-genders.json
      md5: f2195c963e7d82a2e6944a3e024011d5
      size: 249
  schema@all-isbns:
    cmd: python ../run.py --rust pq-info -o all-isbns.json all-isbns.parquet
    deps:
    - path: all-isbns.parquet
      md5: cd83535cac9e7ffba95a44bf6ea49bc6
      size: 264531441
    outs:
    - path: all-isbns.json
      md5: 27d1db71780bc2275009fc2e9ec0f6c7
      size: 675
  schema@cluster-hashes:
    cmd: python ../run.py --rust pq-info -o cluster-hashes.json cluster-hashes.parquet
    deps:
    - path: cluster-hashes.parquet
      md5: 4dbcb0d97ed994ef4fc074d2f9db5894
      size: 377124938
    outs:
    - path: cluster-hashes.json
      md5: eccbfa9c6f5b41a931d581eacce99b23
      size: 344
  schema@isbn-clusters:
    cmd: python ../run.py --rust pq-info -o isbn-clusters.json isbn-clusters.parquet
    deps:
    - path: isbn-clusters.parquet
      md5: 6c80d658cf126eecdae4fc5e963246a4
      size: 326819016
    outs:
    - path: isbn-clusters.json
      md5: 84db54e7ada9e886499ca9a1211a1387
      size: 336
