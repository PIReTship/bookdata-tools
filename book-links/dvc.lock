schema: '2.0'
stages:
  collect-isbns:
    cmd: python ../run.py --rust collect-isbns -o all-isbns.parquet all-isbns.toml
    deps:
    - path: ../az2014/ratings.parquet
      md5: 1a64a821bb159259b584bc1b7e196d11
      size: 147930126
    - path: ../bx/cleaned-ratings.csv
      md5: da3196d4af84ae39b3713e73c59677c7
      size: 22627884
    - path: ../goodreads/gr-book-ids.parquet
      md5: 40d3f3a5914f546c0f71cadf696e8072
      size: 36138262
    - path: ../loc-mds/book-isbns.parquet
      md5: b6b4ebf2da3a565891160c3ab4bfcbc4
      size: 54259877
    - path: ../openlibrary/edition-isbns.parquet
      md5: 0e76c64885ccfb83ad440fedaec3346e
      size: 199068182
    - path: ../src/cli/collect_isbns.rs
      md5: fa71e24fecec60200afb0e9c2066629e
      size: 2545
    - path: all-isbns.toml
      md5: 8d1990ca34a435e464021afb3b5fc9ed
      size: 399
    outs:
    - path: all-isbns.parquet
      md5: bf156d3a836bbb069b89d34dafe9072c
      size: 260095737
  cluster:
    cmd: python run.py --rust cluster-books
    deps:
    - path: book-links/all-isbns.parquet
      md5: f0b746d69f8beb9d099180a62e12531f
      size: 253341052
    - path: goodreads/book-isbn-ids.parquet
      md5: 774b1df89365ef458083ad8204d21ea6
      size: 19538322
    - path: goodreads/gr-book-ids.parquet
      md5: 40d3f3a5914f546c0f71cadf696e8072
      size: 36138262
    - path: loc-mds/book-ids.parquet
      md5: 3707a4a3955cb1a55f3c1acd68fc7454
      size: 64554968
    - path: loc-mds/book-isbn-ids.parquet
      md5: bde3b536165bf2e6f64393b2bb2f2d41
      size: 43725976
    - path: openlibrary/all-works.parquet
      md5: 9efbf40bbf02e5288c8d748361e8ab83
      size: 199516075
    - path: openlibrary/edition-isbn-ids.parquet
      md5: c8fbf36e12cf633f1d53e427715ab58e
      size: 200122567
    - path: openlibrary/edition-works.parquet
      md5: 42b4e843a62bcdf25b43500d76a51d63
      size: 203829867
    - path: openlibrary/editions.parquet
      md5: 2dfe44c47096a8eaa68b8f1c0dc3c855
      size: 980200582
    - path: src/cli/cluster_books.rs
      md5: 22f25214001cd4cf6fde2542ea2f27f3
      size: 4530
    - path: src/graph/
      md5: 3ca1a71be3d3b3ce0d9fde9cfabcceda.dir
      size: 10056
      nfiles: 4
    outs:
    - path: book-links/cluster-graph-edges.parquet
      md5: 553a148a11f5868ced4327b1ba4b0ceb
      size: 484350220
    - path: book-links/cluster-graph-nodes.parquet
      md5: 73a985093fdec0a6a22bcc92e9331cbf
      size: 823952378
    - path: book-links/cluster-metrics.json
      md5: 9ffde9c644652e8e3fc87fcdb378e011
      size: 37
    - path: book-links/cluster-stats.parquet
      md5: 56bbb4f2b9c95e9c8e8e8eaaf19b91fa
      size: 139366235
    - path: book-links/isbn-clusters.parquet
      md5: ca4122f8e8f880f9bb96d69d0b3ac606
      size: 326000194
  cluster-ol-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-ol-first-authors.parquet
      --first-author -s openlib
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5371520a099bfba32e12d5838943bc4e
      size: 311623309
    - path: openlibrary/author-names.parquet
      md5: 2faef21585860b0880c540ff9625d2bb
      size: 163743071
    - path: openlibrary/edition-authors.parquet
      md5: b510eec2ad6e88005821418e9ebc88ae
      size: 195230722
    - path: openlibrary/edition-isbn-ids.parquet
      md5: c8fbf36e12cf633f1d53e427715ab58e
      size: 200122567
    - path: src/cli/cluster
      md5: d5d0e8cce43b9655f682aca7d959f7c2.dir
      size: 25433
      nfiles: 11
    outs:
    - path: book-links/cluster-ol-first-authors.parquet
      md5: 5d7a86bc59601f5f2d04ac8c5e74edc4
      size: 216334440
  cluster-loc-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-loc-first-authors.parquet
      --first-author -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5371520a099bfba32e12d5838943bc4e
      size: 311623309
    - path: loc-mds/book-authors.parquet
      md5: c46c8998dfdfd25b91c88b225a436466
      size: 100853758
    - path: loc-mds/book-isbn-ids.parquet
      md5: bde3b536165bf2e6f64393b2bb2f2d41
      size: 43725976
    - path: src/cli/cluster
      md5: d5d0e8cce43b9655f682aca7d959f7c2.dir
      size: 25433
      nfiles: 11
    outs:
    - path: book-links/cluster-loc-first-authors.parquet
      md5: 4d81445bde86c5506d9cdcd09c2dd4b0
      size: 56040605
  cluster-irst-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5ee9bb4b67de722e24363e140ea2791f
      size: 161946382
    - path: loc-mds/book-authors.parquet
      md5: 2d3212dbf2405c48fb8bf2587a8587c3
      size: 127567010
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: 76f614625858e7ad84e273e875861490
      size: 5253
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a7f439659cccd809efe4ac2ea276b058
      size: 157637977
  cluster-first-authors:
    cmd: python run.py --rust cluster extract-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5371520a099bfba32e12d5838943bc4e
      size: 311623309
    - path: loc-mds/book-authors.parquet
      md5: c46c8998dfdfd25b91c88b225a436466
      size: 100853758
    - path: loc-mds/book-isbn-ids.parquet
      md5: bde3b536165bf2e6f64393b2bb2f2d41
      size: 43725976
    - path: openlibrary/author-names.parquet
      md5: 2faef21585860b0880c540ff9625d2bb
      size: 163743071
    - path: openlibrary/edition-authors.parquet
      md5: b510eec2ad6e88005821418e9ebc88ae
      size: 195230722
    - path: openlibrary/edition-isbn-ids.parquet
      md5: c8fbf36e12cf633f1d53e427715ab58e
      size: 200122567
    - path: src/cli/cluster
      md5: d5d0e8cce43b9655f682aca7d959f7c2.dir
      size: 25433
      nfiles: 11
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a1e1d8d671d240448fbe265eaafbb704
      size: 245294981
  cluster-genders:
    cmd: python run.py --rust cluster extract-author-gender -o book-links/cluster-genders.parquet
      -A book-links/cluster-first-authors.parquet
    deps:
    - path: book-links/cluster-first-authors.parquet
      md5: a1e1d8d671d240448fbe265eaafbb704
      size: 245294981
    - path: book-links/cluster-stats.parquet
      md5: 7eab10f9462aad7f4a70374ef6f7f5a1
      size: 139463305
    - path: src/cli/cluster
      md5: d5d0e8cce43b9655f682aca7d959f7c2.dir
      size: 25433
      nfiles: 11
    - path: viaf/author-genders.parquet
      md5: 67682ca913f02e9fa3321f9bb50bceeb
      size: 120612638
    - path: viaf/author-name-index.parquet
      md5: 9e3cfbb8b0a005d6887fa095fd7d5002
      size: 533510259
    outs:
    - path: book-links/cluster-genders.parquet
      md5: ba64b849da8517699f7b9092beb0bb7c
      size: 126233190
  gender-stats:
    cmd: python ../run.py --rust fusion integration-stats.tcl
    deps:
    - path: ../az2014/az-cluster-ratings.parquet
      md5: 521de16dcb3358d9505f74a76fe80dc2
      size: 302643823
    - path: ../bx/bx-cluster-actions.parquet
      md5: 0726e95c776b8c14dcc6400c491b666a
      size: 7299907
    - path: ../bx/bx-cluster-ratings.parquet
      md5: 06cb1c82eec5311ef2abd6760e026716
      size: 3062054
    - path: ../goodreads/gr-cluster-actions.parquet
      md5: 0646032c031fea4a948624d27af84ace
      size: 2892057603
    - path: ../goodreads/gr-cluster-ratings.parquet
      md5: 72f3e8fbe33e5977219006f8161248f6
      size: 1385712463
    - path: ../loc-mds/book-isbn-ids.parquet
      md5: bde3b536165bf2e6f64393b2bb2f2d41
      size: 43725976
    - path: cluster-genders.parquet
      md5: ba64b849da8517699f7b9092beb0bb7c
      size: 126233190
    - path: integration-stats.tcl
      md5: 0b47c45c920d62c0c476e1eca3b312a5
      size: 1946
    - path: isbn-clusters.parquet
      md5: 5371520a099bfba32e12d5838943bc4e
      size: 311623309
    outs:
    - path: gender-stats.csv
      md5: c5ce23465b4e46731206f39dafb7463f
      size: 1152
  cluster-hashes:
    cmd: python ../run.py --rust cluster hash -o cluster-hashes.parquet isbn-clusters.parquet
    deps:
    - path: ../src/cli/cluster/hash.rs
      md5: 2c485bbde2760877e123c59a6025d59a
      size: 2591
    - path: isbn-clusters.parquet
      md5: ca4122f8e8f880f9bb96d69d0b3ac606
      size: 326000194
    outs:
    - path: cluster-hashes.parquet
      md5: 13ea84d922ba1d208caa0711bde834da
      size: 381418614
  debug-graph:
    cmd: python ./run.py --rust extract-graph --cluster 100004141 -o book-links/debug-graph.gml
    deps:
    - path: book-links/book-graph.mp.zst
      md5: cbb067efc568960af703f83f5b73e9ac
      size: 1283174149
    - path: src/bin/extract-graph.rs
      md5: c22a75eb91d779306a11d8bd2065b3e6
      size: 1142
    outs:
    - path: book-links/debug-graph.gml
      md5: b2fb3c4a07ace6f85a1b880b54ab5da8
      size: 2144356
  schema@cluster-stats:
    cmd: python ../run.py --rust pq-info -o cluster-stats.json cluster-stats.parquet
    deps:
    - path: cluster-stats.parquet
      md5: 7eab10f9462aad7f4a70374ef6f7f5a1
      size: 139463305
    outs:
    - path: cluster-stats.json
      md5: ae5b8a57bd3ca06174386be7a598dd41
      size: 1232
  schema@cluster-first-authors:
    cmd: python ../run.py --rust pq-info -o cluster-first-authors.json cluster-first-authors.parquet
    deps:
    - path: cluster-first-authors.parquet
      md5: a1e1d8d671d240448fbe265eaafbb704
      size: 245294981
    outs:
    - path: cluster-first-authors.json
      md5: 5950e98b23218b6a52ac7fe6e5ea0f5b
      size: 358
  schema@cluster-genders:
    cmd: python ../run.py --rust pq-info -o cluster-genders.json cluster-genders.parquet
    deps:
    - path: cluster-genders.parquet
      md5: ba64b849da8517699f7b9092beb0bb7c
      size: 126233190
    outs:
    - path: cluster-genders.json
      md5: b0ddd3e61ca538e292f237a2b03f27da
      size: 353
  schema@all-isbns:
    cmd: python ../run.py --rust pq-info -o all-isbns.json all-isbns.parquet
    deps:
    - path: all-isbns.parquet
      md5: f0b746d69f8beb9d099180a62e12531f
      size: 253341052
    outs:
    - path: all-isbns.json
      md5: 132cb0a324fe425abdd1ab13be171f20
      size: 1039
  schema@cluster-hashes:
    cmd: python ../run.py --rust pq-info -o cluster-hashes.json cluster-hashes.parquet
    deps:
    - path: cluster-hashes.parquet
      md5: 68f474a16b67501a4951e7fad854adea
      size: 349161302
    outs:
    - path: cluster-hashes.json
      md5: 5ef78319d6cb9d5a78136e5f671abfdd
      size: 500
  schema@isbn-clusters:
    cmd: python ../run.py --rust pq-info -o isbn-clusters.json isbn-clusters.parquet
    deps:
    - path: isbn-clusters.parquet
      md5: 5371520a099bfba32e12d5838943bc4e
      size: 311623309
    outs:
    - path: isbn-clusters.json
      md5: 79f89edbec8ac6c2b7df219b7833b7fe
      size: 492
