schema: '2.0'
stages:
  collect-isbns:
    cmd: python run.py collect-isbns
    deps:
    - path: az2014/ratings.parquet
      md5: 9a3728f744585403cf8c5032a5d5f97f
      size: 139023869
    - path: bx/cleaned-ratings.csv
      md5: da3196d4af84ae39b3713e73c59677c7
      size: 22627884
    - path: goodreads/gr-book-ids.parquet
      md5: 8f268c1ee3abba1df9d30e3aa1452ae5
      size: 41334427
    - path: loc-mds/book-isbns.parquet
      md5: fe10b42e9099807fd3a555894f326cb9
      size: 61308859
    - path: openlibrary/edition-isbns.parquet
      md5: 5f0cfe2b912d5c3427c6e5145a4de618
      size: 163883427
    - path: scripts/collect-isbns.py
      md5: f8e72d3172510e93d538966002609e2a
      size: 2166
    outs:
    - path: book-links/all-isbns.parquet
      md5: 6e3981bc8feeb857d10cbb8984cc67d9
      size: 152341829
  cluster:
    cmd: python run.py --rust cluster-books
    deps:
    - path: book-links/all-isbns.parquet
      md5: 6e3981bc8feeb857d10cbb8984cc67d9
      size: 152341829
    - path: goodreads/book-isbn-ids.parquet
      md5: bd5136302dfbe266dc262052ac408723
      size: 34017607
    - path: goodreads/gr-book-ids.parquet
      md5: 8f268c1ee3abba1df9d30e3aa1452ae5
      size: 41334427
    - path: loc-mds/book-ids.parquet
      md5: bf1c5e34d1a21af873a5d6fc4a9c1385
      size: 73156551
    - path: loc-mds/book-isbn-ids.parquet
      md5: 28c4138c078c5179af8d938f40ed05de
      size: 71409146
    - path: openlibrary/all-works.parquet
      md5: 0c63b9ca6e77c684d6916ac75d939e77
      size: 160430212
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 16f8fc4d8790e2667015b5915e4efc86
      size: 215817740
    - path: openlibrary/edition-works.parquet
      md5: 47a69f3ae12c330d321297e00e5d6efa
      size: 175549574
    - path: openlibrary/editions.parquet
      md5: 0cdeae4d581a4c7c04db4b41a8e1106c
      size: 148809247
    - path: src/bin/cluster-books.rs
      md5: ffe22743e8a673734889b7b62209e38b
      size: 2104
    outs:
    - path: book-links/book-graph.mp.zst
      md5: 078d9e8698d42d0cb341835224000cab
      size: 555836533
    - path: book-links/cluster-codes.parquet
      md5: 9376abe7769af7846a88ffebddb06c5a
      size: 552827934
    - path: book-links/cluster-stats.parquet
      md5: 4c5f40a74649b73cc290dcafdafc4751
      size: 116776477
    - path: book-links/isbn-clusters.parquet
      md5: 88beebfb0465fdd17f5a375ca3bdb2a3
      size: 260459956
  cluster-ol-first-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-ol-first-authors.parquet
      --first-author -s openlib
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: c1b27a37130afa2a02000db6a6f72560
      size: 161947431
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: d32ee6761ce02761550716be04aff6ff
      size: 5058
    outs:
    - path: book-links/cluster-ol-first-authors.parquet
      md5: 904074c232f3b92b06d292a0bf5a59ba
      size: 157503615
  cluster-loc-first-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-loc-first-authors.parquet
      --first-author -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: c1b27a37130afa2a02000db6a6f72560
      size: 161947431
    - path: loc-mds/book-authors.parquet
      md5: 84e80cec0e0df87404a44a03d8d60bf3
      size: 127163262
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: src/bin/cluster-authors.rs
      md5: d32ee6761ce02761550716be04aff6ff
      size: 5058
    outs:
    - path: book-links/cluster-loc-first-authors.parquet
      md5: 7866d20f22fffacbe0775d4ca2e28dba
      size: 58848984
  cluster-irst-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 5ee9bb4b67de722e24363e140ea2791f
      size: 161946382
    - path: loc-mds/book-authors.parquet
      md5: 2d3212dbf2405c48fb8bf2587a8587c3
      size: 127567010
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 4e002793c585a769fc1334827697837e
      size: 142462847
    - path: openlibrary/edition-authors.parquet
      md5: 7172b92182942d728830cdac0b4862b6
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: afa5abff7a53ed402ba9ce4fb2a09635
      size: 214125175
    - path: src/bin/cluster-authors.rs
      md5: 76f614625858e7ad84e273e875861490
      size: 5253
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: a7f439659cccd809efe4ac2ea276b058
      size: 157637977
  cluster-first-authors:
    cmd: python run.py --rust cluster-authors -o book-links/cluster-first-authors.parquet
      --first-author -s openlib -s loc
    deps:
    - path: book-links/isbn-clusters.parquet
      md5: 2e2627c0f3d56448b6707d0054fee4ae
      size: 162095851
    - path: loc-mds/book-authors.parquet
      md5: 6e40b4204f084ec565c570f8b24f44f7
      size: 125125402
    - path: loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: openlibrary/author-names.parquet
      md5: 1396172ca8687d7bb4934914591a653d
      size: 141987553
    - path: openlibrary/edition-authors.parquet
      md5: b073f79aa7818b502231ce195d917721
      size: 164027959
    - path: openlibrary/edition-isbn-ids.parquet
      md5: 16f8fc4d8790e2667015b5915e4efc86
      size: 215817740
    - path: src/bin/cluster-authors.rs
      md5: d32ee6761ce02761550716be04aff6ff
      size: 4899
    outs:
    - path: book-links/cluster-first-authors.parquet
      md5: 0a61dea55fe68968320e23df8c6054be
      size: 199274139
  cluster-genders:
    cmd: python run.py --rust cluster-author-gender -o book-links/cluster-genders.parquet
      -A book-links/cluster-first-authors.parquet
    deps:
    - path: book-links/cluster-first-authors.parquet
      md5: 0a61dea55fe68968320e23df8c6054be
      size: 199274139
    - path: book-links/cluster-stats.parquet
      md5: 5760cfc6948f3f8ec2403e2c79a0211a
      size: 116658827
    - path: src/bin/cluster-author-gender/
      md5: a86e6fa00929f235fead99eae84bcbc7.dir
      size: 7248
      nfiles: 3
    - path: viaf/author-genders.parquet
      md5: 464561c18125c5d813a1643827594d90
      size: 144366853
    - path: viaf/author-name-index.parquet
      md5: a6914dd8cce6f55b71e75446e299dc08
      size: 521031227
    outs:
    - path: book-links/cluster-genders.parquet
      md5: 4e59c5af4eb210f7cc08914e99186449
      size: 112988330
  gender-stats:
    cmd: python ../run.py --rust fusion integration-stats.tcl
    deps:
    - path: ../loc-mds/book-isbn-ids.parquet
      md5: 6a764a693a9baad23d7c489cd3f7bfc9
      size: 70553002
    - path: cluster-genders.parquet
      md5: 4e59c5af4eb210f7cc08914e99186449
      size: 112988330
    - path: integration-stats.tcl
      md5: 6ac932ea6783d039b9924fab344461aa
      size: 995
    - path: isbn-clusters.parquet
      md5: 2e2627c0f3d56448b6707d0054fee4ae
      size: 162095851
    outs:
    - path: gender-stats.csv.gz
      md5: 14c0123920da38e341b6986ece79a750
      size: 163
