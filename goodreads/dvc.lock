schema: '2.0'
stages:
  scan-interactions:
    cmd: python ../run.py --rust goodreads scan interactions ../data/goodreads/goodreads_interactions.json.gz
    deps:
    - path: ../data/goodreads/goodreads_interactions.json.gz
      md5: f2d054a85f33d405a9bff6933005ba89
      size: 9388113365
    - path: ../src/cli/goodreads.rs
      md5: bce76335d099818b685a2c7b53faeb93
      size: 2405
    - path: ../src/goodreads
      md5: 83d9615c1dfdef94838c1013a5b10087.dir
      size: 11279
      nfiles: 5
    - path: gr-book-link.parquet
      md5: a8fbe0288a2682a983fe9550e500ad93
      size: 20310729
    outs:
    - path: gr-interactions.parquet
      md5: 9788655b2499eb8150398f8c1558e823
      size: 4372045343
    - path: gr-users.parquet
      md5: ff0d06650a9944bf80cc8c4a99827c1d
      size: 18683237
  scan-book-info:
    cmd: python ../run.py --rust goodreads scan books ../data/goodreads/goodreads_books.json.gz
    deps:
    - path: ../data/goodreads/goodreads_books.json.gz
      md5: 01b40c70a00fb6aa321ee478f0fd0d6b
      size: 2043729443
    - path: ../src/cli/goodreads
      md5: 9a183d069c3e26425902f894cb7cf4f2.dir
      size: 12357
      nfiles: 4
    - path: ../src/goodreads
      md5: b71b1bcda391d44638b265f72f2dd63d.dir
      size: 15726
      nfiles: 7
    outs:
    - path: gr-book-ids.parquet
      md5: b29c1441c2377d98a803c0cc38b0bc33
      size: 37758445
    - path: gr-book-info.parquet
      md5: 31355888192010795ee0dfd372f10bbf
      size: 15146396
    - path: gr-book-series.parquet
      md5: 420ed851990eab55843d99217af59fae
      size: 5676182
  scan-work-info:
    cmd: python ../run.py --rust goodreads scan works ../data/goodreads/goodreads_book_works.json.gz
    deps:
    - path: ../data/goodreads/goodreads_book_works.json.gz
      md5: e80738a88d02d2b0081cd249d9b4f081
      size: 81412944
    - path: ../src/cli/goodreads
      md5: 9a183d069c3e26425902f894cb7cf4f2.dir
      size: 12357
      nfiles: 4
    - path: ../src/goodreads
      md5: b71b1bcda391d44638b265f72f2dd63d.dir
      size: 15726
      nfiles: 7
    outs:
    - path: gr-work-info.parquet
      md5: 3ebd5a6f7578e3dad3b8654efe9f9704
      size: 21630942
  book-isbn-ids:
    cmd: python run.py --rust link-isbn-ids -o goodreads/book-isbn-ids.parquet -R
      book_id  -I isbn10 -I isbn13 -I asin goodreads/gr-book-ids.parquet
    deps:
    - path: book-links/all-isbns.parquet
      md5: f1de86d41234d3b0ea975be3a188a0cc
      size: 275147630
    - path: goodreads/gr-book-ids.parquet
      md5: b29c1441c2377d98a803c0cc38b0bc33
      size: 37758445
    - path: src/cli/goodreads
      md5: 9a183d069c3e26425902f894cb7cf4f2.dir
      size: 12357
      nfiles: 4
    outs:
    - path: goodreads/book-isbn-ids.parquet
      md5: 26b5fc73cbc447466f64d1de1ccb585b
      size: 15485013
  cluster-ratings:
    cmd: python ../run.py gr-cluster-interactions.py --ratings -o gr-cluster-ratings.parquet
    deps:
    - path: gr-book-link.parquet
      md5: a8fbe0288a2682a983fe9550e500ad93
      size: 20310729
    - path: gr-cluster-interactions.py
      md5: 8d0b11f69d6a0f558570ce36c8bcb585
      size: 2601
    - path: gr-interactions.parquet
      md5: 9788655b2499eb8150398f8c1558e823
      size: 4372045343
    outs:
    - path: gr-cluster-ratings.parquet
      md5: 353cd5edc3df644c77fe01da8f26a436
      size: 1593822465
  book-links:
    cmd: python run.py --rust cluster extract-books -o goodreads/gr-book-link.parquet
      -n book_id --join-file goodreads/gr-book-ids.parquet --join-field work_id GR-B
    deps:
    - path: book-links/cluster-graph-nodes.parquet
      md5: c03cf0b0fd6450d21bbb728a52abf01b
      size: 832827586
    - path: goodreads/gr-book-ids.parquet
      md5: b29c1441c2377d98a803c0cc38b0bc33
      size: 37758445
    outs:
    - path: goodreads/gr-book-link.parquet
      md5: a77c14ec887a12bb23845991b937d6b5
      size: 19848706
  cluster-interactions:
    cmd: python cluster-ratings.py
    deps:
    - path: cluster-ratings.py
      md5: d44be03784268f02b28c1b40bc108c27
      size: 1219
    - path: gr-book-link.parquet
      md5: f31fc29c8644c439e192af9868604a93
      size: 29380146
    - path: gr-interactions.parquet
      md5: 0ee400ec374aa0263198b25e9d9140e0
      size: 1619196241
    outs:
    - path: gr-cluster-ratings.parquet
      md5: af8b42db6e3b8f0ded896f7cab433530
      size: 327784394
  cluster-actions:
    cmd: python ../run.py gr-cluster-interactions.py --add-actions -o gr-cluster-actions.parquet
    deps:
    - path: gr-book-link.parquet
      md5: a8fbe0288a2682a983fe9550e500ad93
      size: 20310729
    - path: gr-cluster-interactions.py
      md5: 8d0b11f69d6a0f558570ce36c8bcb585
      size: 2601
    - path: gr-interactions.parquet
      md5: 9788655b2499eb8150398f8c1558e823
      size: 4372045343
    outs:
    - path: gr-cluster-actions.parquet
      md5: a93581e4cc78bf216b34358417954393
      size: 1525089046
  work-ratings:
    cmd: python ../run.py gr-cluster-interactions.py --native-works --ratings -o gr-work-ratings.parquet
    deps:
    - path: gr-cluster-interactions.py
      md5: 8d0b11f69d6a0f558570ce36c8bcb585
      size: 2601
    - path: gr-interactions.parquet
      md5: 9788655b2499eb8150398f8c1558e823
      size: 4372045343
    outs:
    - path: gr-work-ratings.parquet
      md5: 0d9f519acad4d8f1b94dafc54bace4a3
      size: 1640676645
  work-actions:
    cmd: python ../run.py gr-cluster-interactions.py --native-works --add-actions
      -o gr-work-actions.parquet
    deps:
    - path: gr-cluster-interactions.py
      md5: 8d0b11f69d6a0f558570ce36c8bcb585
      size: 2601
    - path: gr-interactions.parquet
      md5: 9788655b2499eb8150398f8c1558e823
      size: 4372045343
    outs:
    - path: gr-work-actions.parquet
      md5: a15faa45f6b956f93a7795b453d946e8
      size: 1569601498
  work-gender:
    cmd: python ../run.py --rust goodreads work-gender
    deps:
    - path: ../book-links/cluster-genders.parquet
      md5: 506185f98acd90041e1a7d5ed93c58fa
      size: 127851092
    - path: ../src/cli/goodreads
      md5: 9a183d069c3e26425902f894cb7cf4f2.dir
      size: 12357
      nfiles: 4
    - path: gr-book-link.parquet
      md5: a77c14ec887a12bb23845991b937d6b5
      size: 19848706
    outs:
    - path: gr-work-gender.parquet
      md5: 2aebf2d2e698987c25bf3b2da8e2f792
      size: 29110471
  schema@gr-work-gender:
    cmd: python ../run.py --rust pq-info -o gr-work-gender.json gr-work-gender.parquet
    deps:
    - path: gr-work-gender.parquet
      md5: 2aebf2d2e698987c25bf3b2da8e2f792
      size: 29110471
    outs:
    - path: gr-work-gender.json
      md5: 2b67b1d3bde7dcf7e89f34094302ae35
      size: 423
  schema@gr-work-info:
    cmd: python ../run.py --rust pq-info -o gr-work-info.json gr-work-info.parquet
    deps:
    - path: gr-work-info.parquet
      md5: 3ebd5a6f7578e3dad3b8654efe9f9704
      size: 21630942
    outs:
    - path: gr-work-info.json
      md5: 53032fe59b518f9d06a4ff04ccb1e118
      size: 517
  schema@gr-work-actions:
    cmd: python ../run.py --rust pq-info -o gr-work-actions.json gr-work-actions.parquet
    deps:
    - path: gr-work-actions.parquet
      md5: a15faa45f6b956f93a7795b453d946e8
      size: 1569601498
    outs:
    - path: gr-work-actions.json
      md5: fbd53ff95cd17f34166e93c8b039cb07
      size: 618
  schema@gr-work-ratings:
    cmd: python ../run.py --rust pq-info -o gr-work-ratings.json gr-work-ratings.parquet
    deps:
    - path: gr-work-ratings.parquet
      md5: 0d9f519acad4d8f1b94dafc54bace4a3
      size: 1640676645
    outs:
    - path: gr-work-ratings.json
      md5: 77c0c065962ddeee0d183dae1ac1e897
      size: 708
  schema@gr-book-info:
    cmd: python ../run.py --rust pq-info -o gr-book-info.json gr-book-info.parquet
    deps:
    - path: gr-book-info.parquet
      md5: 31355888192010795ee0dfd372f10bbf
      size: 15146396
    outs:
    - path: gr-book-info.json
      md5: af0d725e807d1e6b320851dbf144ce9f
      size: 518
  schema@book-isbn-ids:
    cmd: python ../run.py --rust pq-info -o book-isbn-ids.json book-isbn-ids.parquet
    deps:
    - path: book-isbn-ids.parquet
      md5: 26b5fc73cbc447466f64d1de1ccb585b
      size: 15485013
    outs:
    - path: book-isbn-ids.json
      md5: 7cc81e5c2f2d725d468689bb0c502229
      size: 249
  schema@gr-interactions:
    cmd: python ../run.py --rust pq-info -o gr-interactions.json gr-interactions.parquet
    deps:
    - path: gr-interactions.parquet
      md5: 9788655b2499eb8150398f8c1558e823
      size: 4372045343
    outs:
    - path: gr-interactions.json
      md5: 9b3af7db2bcd5cb7616d6f0a17daefb4
      size: 990
  schema@gr-book-ids:
    cmd: python ../run.py --rust pq-info -o gr-book-ids.json gr-book-ids.parquet
    deps:
    - path: gr-book-ids.parquet
      md5: b29c1441c2377d98a803c0cc38b0bc33
      size: 37758445
    outs:
    - path: gr-book-ids.json
      md5: 9b7fd900a00eb12f94ae887d48f0f638
      size: 507
  schema@gr-cluster-ratings:
    cmd: python ../run.py --rust pq-info -o gr-cluster-ratings.json gr-cluster-ratings.parquet
    deps:
    - path: gr-cluster-ratings.parquet
      md5: 353cd5edc3df644c77fe01da8f26a436
      size: 1593822465
    outs:
    - path: gr-cluster-ratings.json
      md5: 6a5a2ef9fa4305c24fd17082f9d976e4
      size: 707
  schema@gr-users:
    cmd: python ../run.py --rust pq-info -o gr-users.json gr-users.parquet
    deps:
    - path: gr-users.parquet
      md5: ff0d06650a9944bf80cc8c4a99827c1d
      size: 18683237
    outs:
    - path: gr-users.json
      md5: 70a463f659828f45949b5288557788f7
      size: 244
  schema@gr-book-link:
    cmd: python ../run.py --rust pq-info -o gr-book-link.json gr-book-link.parquet
    deps:
    - path: gr-book-link.parquet
      md5: a77c14ec887a12bb23845991b937d6b5
      size: 19848706
    outs:
    - path: gr-book-link.json
      md5: 68e8a9f6a268251c5078844b36762bab
      size: 338
  schema@gr-cluster-actions:
    cmd: python ../run.py --rust pq-info -o gr-cluster-actions.json gr-cluster-actions.parquet
    deps:
    - path: gr-cluster-actions.parquet
      md5: a93581e4cc78bf216b34358417954393
      size: 1525089046
    outs:
    - path: gr-cluster-actions.json
      md5: 6929df3364058a637d1aa4df32ba5567
      size: 617
  scan-book-genres:
    cmd: python ../run.py --rust goodreads scan genres ../data/goodreads/goodreads_book_genres_initial.json.gz
    deps:
    - path: ../data/goodreads/goodreads_book_genres_initial.json.gz
      md5: 99ee3d1cadd68818c3dd0ef0d2f10602
      size: 24253992
    - path: ../src/cli/goodreads
      md5: 9a183d069c3e26425902f894cb7cf4f2.dir
      size: 12357
      nfiles: 4
    - path: ../src/goodreads
      md5: b71b1bcda391d44638b265f72f2dd63d.dir
      size: 15726
      nfiles: 7
    outs:
    - path: gr-book-genres.parquet
      md5: 7487263fb61254a30aad485fc7935baf
      size: 17208611
    - path: gr-genres.parquet
      md5: 0d0f791d77523de16f89a5063cf86e85
      size: 812
  schema@gr-genres:
    cmd: python ../run.py --rust pq-info -o gr-genres.json gr-genres.parquet
    deps:
    - path: gr-genres.parquet
      md5: 0d0f791d77523de16f89a5063cf86e85
      size: 812
    outs:
    - path: gr-genres.json
      md5: 358d9ee49ebe133ef3b634bf791c4abd
      size: 235
  schema@gr-book-series:
    cmd: python ../run.py --rust pq-info -o gr-book-series.json gr-book-series.parquet
    deps:
    - path: gr-book-series.parquet
      md5: 420ed851990eab55843d99217af59fae
      size: 5676182
    outs:
    - path: gr-book-series.json
      md5: 1f5edf3d4c1d81541b89a7d4847d1a34
      size: 245
  schema@gr-book-genres:
    cmd: python ../run.py --rust pq-info -o gr-book-genres.json gr-book-genres.parquet
    deps:
    - path: gr-book-genres.parquet
      md5: 7487263fb61254a30aad485fc7935baf
      size: 17208611
    outs:
    - path: gr-book-genres.json
      md5: e6ba5a4a0538048dbb7addd444905809
      size: 338
  scan-simple-interactions:
    cmd: python ../run.py --rust goodreads scan interactions --csv --book-map ../data/goodreads/book_id_map.csv
      ../data/goodreads/goodreads_interactions.csv
    deps:
    - path: ../data/goodreads/book_id_map.csv
      md5: c4e5afd568df2f7a4a8a52f3eeb88413
      size: 37846957
    - path: ../data/goodreads/goodreads_interactions.csv
      md5: 696fbf71f0082c0b6a2379182b147c1e
      size: 4318621741
    - path: ../src/cli/goodreads.rs
      md5: 1fe05e7e29045b7ad1528df9af270c2d
      size: 3080
    - path: ../src/goodreads
      md5: 2a97b45388d5581a7db8e442cba294fb.dir
      size: 13762
      nfiles: 6
    outs:
    - path: gr-simple-interactions.parquet
      md5: e01dd1692896c9ae0a2b18e94b94e5aa
      size: 1456440955
  cluster-simple-ratings:
    cmd: python ../run.py gr-cluster-interactions.py --ratings --simple -o gr-cluster-simple-ratings.parquet
    deps:
    - path: gr-book-link.parquet
      md5: a8fbe0288a2682a983fe9550e500ad93
      size: 20310729
    - path: gr-cluster-interactions.py
      md5: f3bff4368de9ccfc6a9d92f9787eceb8
      size: 4159
    - path: gr-simple-interactions.parquet
      md5: e01dd1692896c9ae0a2b18e94b94e5aa
      size: 1456440955
    outs:
    - path: gr-cluster-simple-ratings.parquet
      md5: 0675244e9a9ba0d451bbe12dbcb3cbe4
      size: 689950939
